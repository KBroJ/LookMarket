# Mock ì™„ë²½ ê°€ì´ë“œ - í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ í•µì‹¬ ê°œë…

> **ì‘ì„±ì¼ì‹œ**: 2025-12-16 23:46
>
> ì´ ë¬¸ì„œëŠ” Spring Boot í…ŒìŠ¤íŠ¸ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ëŠ” Mock ê´€ë ¨ ê°œë…ë“¤ì„ ì •ë¦¬í•œ í•™ìŠµ ìë£Œì…ë‹ˆë‹¤.

## ëª©ì°¨
1. [Mockì´ë€ ë¬´ì—‡ì¸ê°€?](#mockì´ë€-ë¬´ì—‡ì¸ê°€)
2. [Mock ê´€ë ¨ ì–´ë…¸í…Œì´ì…˜ ì •ë¦¬](#mock-ê´€ë ¨-ì–´ë…¸í…Œì´ì…˜-ì •ë¦¬)
3. [@Mockê³¼ @InjectMocks](#1-mockê³¼-injectmocks-mockito---ë‹¨ìœ„-í…ŒìŠ¤íŠ¸)
4. [@MockBean](#2-mockbean-spring-boot-test---í†µí•©-í…ŒìŠ¤íŠ¸)
5. [MockMvc](#3-mockmvc-http-ìš”ì²­-ì‹œë®¬ë ˆì´ì…˜)
6. [í…ŒìŠ¤íŠ¸ ì¢…ë¥˜ë³„ ì‚¬ìš© íŒ¨í„´](#4-í…ŒìŠ¤íŠ¸-ì¢…ë¥˜ë³„-ì‚¬ìš©-íŒ¨í„´-ì •ë¦¬)
7. [ìì£¼ ì“°ëŠ” Mockito ë©”ì„œë“œ](#5-ìì£¼-ì“°ëŠ”-mockito-ë©”ì„œë“œ)
8. [ì‹¤ì œ í”„ë¡œì íŠ¸ ì ìš© ì˜ˆì‹œ](#6-ì‹¤ì œ-í”„ë¡œì íŠ¸-ì ìš©-ì˜ˆì‹œ)

---

## Mockì´ë€ ë¬´ì—‡ì¸ê°€?

**Mock(ëª¨ì˜ ê°ì²´)**ì€ ì‹¤ì œ ê°ì²´ë¥¼ í‰ë‚´ ë‚´ëŠ” ê°€ì§œ ê°ì²´ì…ë‹ˆë‹¤.

### ì™œ Mockì´ í•„ìš”í•œê°€?

```
ì‹¤ì œ ìƒí™©: UserServiceë¥¼ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ë‹¤
    â†“
ë¬¸ì œ: UserServiceê°€ UserRepository(DB ì—°ê²°)ì— ì˜ì¡´í•œë‹¤
    â†“
í•´ê²°: UserRepositoryë¥¼ "ê°€ì§œ"ë¡œ ë§Œë“¤ì–´ì„œ DB ì—†ì´ í…ŒìŠ¤íŠ¸
```

**ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°:**
- ì˜í™” ì´¬ì˜ì—ì„œ ìœ„í—˜í•œ ì¥ë©´ì€ **ìŠ¤í„´íŠ¸ë§¨(Mock)**ì´ ëŒ€ì‹ í•œë‹¤
- ì‹¤ì œ ë°°ìš°(ì‹¤ì œ ê°ì²´) ëŒ€ì‹  ìŠ¤í„´íŠ¸ë§¨ì´ í–‰ë™í•˜ì§€ë§Œ, ì˜í™”ì—ì„  ë°°ìš°ì²˜ëŸ¼ ë³´ì¸ë‹¤
- í…ŒìŠ¤íŠ¸ì—ì„œë„ ì‹¤ì œ DB/ì™¸ë¶€ API ëŒ€ì‹  Mockì´ ê·¸ ì—­í• ì„ í•œë‹¤

### Mock ì‚¬ìš©ì˜ ì¥ì 

| ì¥ì  | ì„¤ëª… |
|------|------|
| **ë…ë¦½ì„±** | ì™¸ë¶€ ì‹œìŠ¤í…œ(DB, API) ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ |
| **ì†ë„** | ì‹¤ì œ I/O ì—†ì´ ë©”ëª¨ë¦¬ì—ì„œ ë¹ ë¥´ê²Œ ì‹¤í–‰ |
| **ì œì–´** | ì›í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤(ì„±ê³µ, ì‹¤íŒ¨, ì˜ˆì™¸)ë¥¼ ì‰½ê²Œ ì¬í˜„ |
| **ê²°ì •ì„±** | í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ í•­ìƒ ë™ì¼ (ì™¸ë¶€ ìš”ì¸ ì œê±°) |

---

## Mock ê´€ë ¨ ì–´ë…¸í…Œì´ì…˜ ì •ë¦¬

| ì–´ë…¸í…Œì´ì…˜ | ì œê³µ ë¼ì´ë¸ŒëŸ¬ë¦¬ | ìš©ë„ | ì‚¬ìš© ìœ„ì¹˜ |
|-----------|---------------|------|----------|
| `@Mock` | Mockito | ê°€ì§œ ê°ì²´ ìƒì„± | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ |
| `@InjectMocks` | Mockito | Mockì„ ì£¼ì…ë°›ëŠ” ëŒ€ìƒ | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ |
| `@MockBean` | Spring Boot Test | Spring Contextì— ê°€ì§œ ë¹ˆ ë“±ë¡ | í†µí•© í…ŒìŠ¤íŠ¸ |
| `@Autowired MockMvc` | Spring Test | HTTP ìš”ì²­ ì‹œë®¬ë ˆì´ì…˜ | ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ |

---

## 1. @Mockê³¼ @InjectMocks (Mockito - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)

### ê°œë…

```
@InjectMocks: "ì´ ê°ì²´ë¥¼ í…ŒìŠ¤íŠ¸í•  ê±°ì•¼, ì˜ì¡´ì„±ì€ Mockìœ¼ë¡œ ì±„ì›Œì¤˜"
@Mock: "ì´ê±´ ê°€ì§œ ê°ì²´ì•¼, ë‚´ê°€ ë™ì‘ì„ ì§€ì •í•´ì¤„ê²Œ"
```

### ì‹¤ì œ ì˜ˆì‹œ - AuthServiceTest

```java
@ExtendWith(MockitoExtension.class)  // Mockito í™œì„±í™”
class AuthServiceTest {

    @InjectMocks   // í…ŒìŠ¤íŠ¸ ëŒ€ìƒ - Mockë“¤ì´ ìë™ ì£¼ì…ë¨
    private AuthService authService;

    @Mock          // ê°€ì§œ UserRepository
    private UserRepository userRepository;

    @Mock          // ê°€ì§œ PasswordEncoder
    private PasswordEncoder passwordEncoder;
```

**êµ¬ì¡° ì‹œê°í™”:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           AuthService (ì‹¤ì œ)             â”‚
â”‚              @InjectMocks               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ UserRepository  â”‚ â”‚ PasswordEncoderâ”‚ â”‚
â”‚  â”‚     @Mock       â”‚ â”‚     @Mock      â”‚ â”‚
â”‚  â”‚   (ê°€ì§œ ê°ì²´)    â”‚ â”‚   (ê°€ì§œ ê°ì²´)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë™ì‘ ì§€ì •í•˜ê¸° (given-when-then)

```java
@Test
void ë¡œê·¸ì¸_ì„±ê³µ() {
    // given - Mockì˜ ë™ì‘ì„ ë¯¸ë¦¬ ì •ì˜
    given(userRepository.findByEmail("test@example.com"))
        .willReturn(Optional.of(testUser));  // "ì´ ë©”ì„œë“œ í˜¸ì¶œí•˜ë©´ testUser ë°˜í™˜í•´"

    given(passwordEncoder.matches("password123", "encodedPassword"))
        .willReturn(true);  // "ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜í•œë‹¤ê³  í•´ì¤˜"

    // when - ì‹¤ì œ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë©”ì„œë“œ í˜¸ì¶œ
    User result = authService.authenticate("test@example.com", "password123");

    // then - ê²°ê³¼ ê²€ì¦
    assertThat(result.getEmail()).isEqualTo("test@example.com");
}
```

**íë¦„ ë‹¤ì´ì–´ê·¸ë¨:**
```
í…ŒìŠ¤íŠ¸ ì½”ë“œ                    AuthService                 Mock ê°ì²´ë“¤
    â”‚                            â”‚                            â”‚
    â”‚ authenticate() í˜¸ì¶œ         â”‚                            â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                            â”‚
    â”‚                            â”‚ findByEmail() í˜¸ì¶œ          â”‚
    â”‚                            â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
    â”‚                            â”‚                            â”‚
    â”‚                            â”‚ â—„â”€â”€â”€â”€â”€ testUser ë°˜í™˜ â”€â”€â”€â”€â”€â”€ â”‚
    â”‚                            â”‚                            â”‚
    â”‚                            â”‚ matches() í˜¸ì¶œ              â”‚
    â”‚                            â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
    â”‚                            â”‚                            â”‚
    â”‚                            â”‚ â—„â”€â”€â”€â”€â”€â”€ true ë°˜í™˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
    â”‚                            â”‚                            â”‚
    â”‚ â—„â”€â”€ User ë°˜í™˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                            â”‚
```

### @ExtendWith(MockitoExtension.class)ì˜ ì—­í• 

```java
@ExtendWith(MockitoExtension.class)  // ì´ê²Œ ì—†ìœ¼ë©´ @Mock, @InjectMocksê°€ ë™ì‘ ì•ˆ í•¨!
class MyServiceTest {
    // ...
}
```

ì´ ì–´ë…¸í…Œì´ì…˜ì´ í•˜ëŠ” ì¼:
1. `@Mock` ë¶™ì€ í•„ë“œì— Mock ê°ì²´ ìƒì„±
2. `@InjectMocks` ë¶™ì€ í•„ë“œì— Mockë“¤ì„ ì£¼ì…
3. ê° í…ŒìŠ¤íŠ¸ í›„ Mock ìƒíƒœ ì´ˆê¸°í™”

---

## 2. @MockBean (Spring Boot Test - í†µí•© í…ŒìŠ¤íŠ¸)

### @Mock vs @MockBean ì°¨ì´

| êµ¬ë¶„ | @Mock | @MockBean |
|------|-------|-----------|
| **ì»¨í…ìŠ¤íŠ¸** | ìˆœìˆ˜ Mockito | Spring ApplicationContext |
| **ë¹ˆ ë“±ë¡** | X | O (Spring ë¹ˆìœ¼ë¡œ ë“±ë¡) |
| **ì‚¬ìš©ì²˜** | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ | í†µí•© í…ŒìŠ¤íŠ¸, @WebMvcTest |
| **ì†ë„** | ë¹ ë¦„ | ìƒëŒ€ì ìœ¼ë¡œ ëŠë¦¼ |
| **í•„ìš” ì–´ë…¸í…Œì´ì…˜** | @ExtendWith(MockitoExtension.class) | @SpringBootTest ë˜ëŠ” @WebMvcTest |

### ì‹¤ì œ ì˜ˆì‹œ - AuthControllerTest

```java
@WebMvcTest(AuthController.class)  // ì»¨íŠ¸ë¡¤ëŸ¬ë§Œ ë¡œë“œí•˜ëŠ” ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸
class AuthControllerTest {

    @Autowired
    private MockMvc mockMvc;  // HTTP ìš”ì²­ ì‹œë®¬ë ˆì´ì…˜

    @MockBean  // Spring Contextì— ê°€ì§œ AuthService ë“±ë¡
    private AuthService authService;
```

**@MockBeanì´ í•„ìš”í•œ ì´ìœ :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Spring Context â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  AuthController (ì‹¤ì œ)                                â”‚
â”‚       â”‚                                              â”‚
â”‚       â””â”€â”€â”€â”€ AuthService í•„ìš”!                         â”‚
â”‚              â”‚                                       â”‚
â”‚              â””â”€â–º @MockBeanìœ¼ë¡œ ê°€ì§œ ë¹ˆ ì£¼ì…           â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì–¸ì œ @MockBeanì„ ì‚¬ìš©í•˜ë‚˜?

1. **@WebMvcTest** - ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ ì‹œ Serviceë¥¼ Mock
2. **@SpringBootTest** - ì™¸ë¶€ API í´ë¼ì´ì–¸íŠ¸ë¥¼ Mock
3. **ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸** - í…ŒìŠ¤íŠ¸ ë²”ìœ„ ì™¸ì˜ ë¹ˆì„ Mock

### ì‚¬ìš© ì˜ˆì‹œ

```java
@Test
void ë¡œê·¸ì¸_API_ì„±ê³µ() throws Exception {
    // given - MockBeanì˜ ë™ì‘ ì •ì˜
    given(authService.authenticate(anyString(), anyString()))
        .willReturn(testUser);

    LoginRequest request = new LoginRequest("test@example.com", "password123");

    // when & then - HTTP ìš”ì²­ ì‹œë®¬ë ˆì´ì…˜
    mockMvc.perform(post("/api/v1/auth/login")
            .contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request)))
        .andExpect(status().isOk())
        .andExpect(jsonPath("$.accessToken").isNotEmpty());
}
```

---

## 3. MockMvc (HTTP ìš”ì²­ ì‹œë®¬ë ˆì´ì…˜)

### ê°œë…

**MockMvc**ëŠ” ì‹¤ì œ ì„œë²„ë¥¼ ë„ìš°ì§€ ì•Šê³  HTTP ìš”ì²­/ì‘ë‹µì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

```
ì‹¤ì œ í™˜ê²½:  í´ë¼ì´ì–¸íŠ¸ â†’ í†°ìº£ ì„œë²„ â†’ ì»¨íŠ¸ë¡¤ëŸ¬
í…ŒìŠ¤íŠ¸:    MockMvc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ì»¨íŠ¸ë¡¤ëŸ¬
           (ì„œë²„ ì—†ì´ ì§ì ‘ í˜¸ì¶œ)
```

### MockMvc ì„¤ì • ë°©ë²•

**ë°©ë²• 1: @WebMvcTest (ê¶Œì¥ - ì»¨íŠ¸ë¡¤ëŸ¬ë§Œ í…ŒìŠ¤íŠ¸)**
```java
@WebMvcTest(UserController.class)
class UserControllerTest {
    @Autowired
    private MockMvc mockMvc;  // ìë™ ì£¼ì…
}
```

**ë°©ë²• 2: @SpringBootTest + @AutoConfigureMockMvc (í†µí•© í…ŒìŠ¤íŠ¸)**
```java
@SpringBootTest
@AutoConfigureMockMvc
class IntegrationTest {
    @Autowired
    private MockMvc mockMvc;
}
```

### MockMvc ì£¼ìš” ë©”ì„œë“œ

```java
// 1. HTTP ë©”ì„œë“œ
mockMvc.perform(get("/api/users"))       // GET ìš”ì²­
mockMvc.perform(post("/api/users"))      // POST ìš”ì²­
mockMvc.perform(put("/api/users/1"))     // PUT ìš”ì²­
mockMvc.perform(delete("/api/users/1"))  // DELETE ìš”ì²­
mockMvc.perform(patch("/api/users/1"))   // PATCH ìš”ì²­

// 2. ìš”ì²­ ì„¤ì •
.contentType(MediaType.APPLICATION_JSON)  // Content-Type í—¤ë”
.content("{\"email\":\"test@test.com\"}")  // ìš”ì²­ ë³¸ë¬¸
.header("Authorization", "Bearer token")   // í—¤ë” ì¶”ê°€
.param("page", "1")                        // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°
.cookie(new Cookie("session", "abc"))      // ì¿ í‚¤ ì¶”ê°€

// 3. ì‘ë‹µ ìƒíƒœ ê²€ì¦
.andExpect(status().isOk())               // 200 OK
.andExpect(status().isCreated())          // 201 Created
.andExpect(status().isBadRequest())       // 400 Bad Request
.andExpect(status().isUnauthorized())     // 401 Unauthorized
.andExpect(status().isForbidden())        // 403 Forbidden
.andExpect(status().isNotFound())         // 404 Not Found

// 4. JSON ì‘ë‹µ ê²€ì¦ (JsonPath)
.andExpect(jsonPath("$.email").value("test@test.com"))
.andExpect(jsonPath("$.id").isNumber())
.andExpect(jsonPath("$.items").isArray())
.andExpect(jsonPath("$.items.length()").value(3))
.andExpect(jsonPath("$.items[0].name").value("ì²«ë²ˆì§¸"))
.andExpect(jsonPath("$.data").isEmpty())
.andExpect(jsonPath("$.data").doesNotExist())

// 5. ì‘ë‹µ í—¤ë” ê²€ì¦
.andExpect(header().string("Location", "/api/users/1"))
.andExpect(header().exists("X-Custom-Header"))

// 6. ë””ë²„ê¹…
.andDo(print())  // ìš”ì²­/ì‘ë‹µ ìƒì„¸ ì¶œë ¥
```

### ì „ì²´ ì˜ˆì‹œ

```java
@Test
void íšŒì›ê°€ì…_ìœ íš¨ì„±_ê²€ì¦_ì‹¤íŒ¨() throws Exception {
    // given - ì˜ëª»ëœ ì´ë©”ì¼ í˜•ì‹
    LoginRequest request = new LoginRequest("invalid-email", "password123");

    // when & then
    mockMvc.perform(post("/api/v1/auth/login")
            .contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request)))
        .andDo(print())  // ìš”ì²­/ì‘ë‹µ ì¶œë ¥ (ë””ë²„ê¹…ìš©)
        .andExpect(status().isBadRequest())
        .andExpect(jsonPath("$.code").value("VALIDATION_FAILED"));
}
```

### print() ì¶œë ¥ ì˜ˆì‹œ

```
MockHttpServletRequest:
      HTTP Method = POST
      Request URI = /api/v1/auth/login
       Parameters = {}
          Headers = [Content-Type:"application/json"]
             Body = {"email":"invalid-email","password":"password123"}

MockHttpServletResponse:
           Status = 400
    Error message = null
          Headers = [Content-Type:"application/json"]
             Body = {"code":"VALIDATION_FAILED","message":"ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤"}
```

---

## 4. í…ŒìŠ¤íŠ¸ ì¢…ë¥˜ë³„ ì‚¬ìš© íŒ¨í„´ ì •ë¦¬

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Test)

**ëª©ì :** í•˜ë‚˜ì˜ í´ë˜ìŠ¤/ë©”ì„œë“œë¥¼ ê³ ë¦½ì‹œì¼œ í…ŒìŠ¤íŠ¸

```java
@ExtendWith(MockitoExtension.class)
class UserServiceTest {

    @InjectMocks
    private UserService userService;  // í…ŒìŠ¤íŠ¸ ëŒ€ìƒ

    @Mock
    private UserRepository userRepository;  // ì˜ì¡´ì„±ì€ Mock

    @Test
    void ì‚¬ìš©ì_ì¡°íšŒ_ì„±ê³µ() {
        // given
        given(userRepository.findById(1L))
            .willReturn(Optional.of(user));

        // when
        User result = userService.getUser(1L);

        // then
        assertThat(result.getId()).isEqualTo(1L);
    }
}
```

**íŠ¹ì§•:**
- Spring ì—†ì´ ìˆœìˆ˜ Javaë¡œ ë¹ ë¥´ê²Œ í…ŒìŠ¤íŠ¸
- ì™¸ë¶€ ì˜ì¡´ì„± ì™„ì „ ì°¨ë‹¨
- ì‹¤í–‰ ì†ë„: ë°€ë¦¬ì´ˆ ë‹¨ìœ„

### ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸ (@WebMvcTest)

**ëª©ì :** ì»¨íŠ¸ë¡¤ëŸ¬ ë ˆì´ì–´ë§Œ í…ŒìŠ¤íŠ¸

```java
@WebMvcTest(UserController.class)
class UserControllerTest {

    @Autowired
    private MockMvc mockMvc;  // HTTP í…ŒìŠ¤íŠ¸

    @MockBean
    private UserService userService;  // ServiceëŠ” Mock

    @Test
    void ì‚¬ìš©ì_ì¡°íšŒ_API_ì„±ê³µ() throws Exception {
        // given
        given(userService.getUser(1L)).willReturn(user);

        // when & then
        mockMvc.perform(get("/api/users/1"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.id").value(1));
    }
}
```

**íŠ¹ì§•:**
- ì»¨íŠ¸ë¡¤ëŸ¬ + Spring MVC ì„¤ì •ë§Œ ë¡œë“œ
- Service ì´í•˜ëŠ” MockBeanìœ¼ë¡œ ëŒ€ì²´
- ì‹¤í–‰ ì†ë„: ì´ˆ ë‹¨ìœ„

### í†µí•© í…ŒìŠ¤íŠ¸ (@SpringBootTest)

**ëª©ì :** ì—¬ëŸ¬ ë ˆì´ì–´ë¥¼ í•¨ê»˜ í…ŒìŠ¤íŠ¸

```java
@SpringBootTest
@AutoConfigureMockMvc
class UserIntegrationTest {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private ExternalApiClient externalApi;  // ì™¸ë¶€ APIë§Œ Mock

    @Test
    void ì‚¬ìš©ì_ìƒì„±_í†µí•©í…ŒìŠ¤íŠ¸() throws Exception {
        // ì‹¤ì œ Service, Repository ì‚¬ìš©
        // DBëŠ” H2 ë˜ëŠ” Testcontainers ì‚¬ìš©
        mockMvc.perform(post("/api/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content("{\"email\":\"new@test.com\"}"))
            .andExpect(status().isCreated());
    }
}
```

**íŠ¹ì§•:**
- ì „ì²´ Spring Context ë¡œë“œ
- ì‹¤ì œ ë¹ˆë“¤ì´ ì—°ë™ë˜ì–´ ë™ì‘
- ì™¸ë¶€ ì˜ì¡´ì„±(API, ë©”ì‹œì§€í)ë§Œ Mock
- ì‹¤í–‰ ì†ë„: ìˆ˜ ì´ˆ ~ ìˆ˜ì‹­ ì´ˆ

### í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ

```
        /\
       /  \      E2E í…ŒìŠ¤íŠ¸ (ì ê²Œ)
      /____\     - ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
     /      \
    /________\   í†µí•© í…ŒìŠ¤íŠ¸ (ì¤‘ê°„)
   /          \  - @SpringBootTest
  /____________\
 /              \ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ë§ì´)
/________________\- @Mock, @InjectMocks
```

---

## 5. ìì£¼ ì“°ëŠ” Mockito ë©”ì„œë“œ

### ë™ì‘ ì§€ì • (Stubbing)

```java
// BDDMockito ìŠ¤íƒ€ì¼ (ê¶Œì¥ - given/when/thenê³¼ ì¼ê´€ì„±)
import static org.mockito.BDDMockito.given;

given(repository.findById(1L)).willReturn(Optional.of(user));
given(repository.save(any())).willReturn(savedUser);
given(service.process(anyString())).willThrow(new RuntimeException("ì—ëŸ¬"));

// ì „í†µì ì¸ Mockito ìŠ¤íƒ€ì¼
import static org.mockito.Mockito.when;

when(repository.findById(1L)).thenReturn(Optional.of(user));
when(repository.save(any())).thenThrow(new IllegalArgumentException());
```

### Argument Matchers (ì¸ì ë§¤ì²˜)

```java
import static org.mockito.ArgumentMatchers.*;

any()              // ì•„ë¬´ ê°’ì´ë‚˜ (null í¬í•¨)
any(User.class)    // User íƒ€ì… ì•„ë¬´ê±°ë‚˜
anyString()        // ì•„ë¬´ ë¬¸ìì—´ (null ì œì™¸)
anyLong()          // ì•„ë¬´ Long
anyInt()           // ì•„ë¬´ int
anyList()          // ì•„ë¬´ List
anyMap()           // ì•„ë¬´ Map
anySet()           // ì•„ë¬´ Set

eq("specific")     // ì •í™•íˆ "specific"ê³¼ ì¼ì¹˜
eq(123L)           // ì •í™•íˆ 123Lê³¼ ì¼ì¹˜

isNull()           // nullì¸ ê²½ìš°
isNotNull()        // nullì´ ì•„ë‹Œ ê²½ìš°

// ì»¤ìŠ¤í…€ ì¡°ê±´
argThat(arg -> arg.length() > 5)           // ê¸¸ì´ê°€ 5ë³´ë‹¤ í° ë¬¸ìì—´
argThat(user -> user.getAge() >= 18)       // ë‚˜ì´ê°€ 18 ì´ìƒì¸ User
```

**ì£¼ì˜: Matcher í˜¼ìš© ê·œì¹™**
```java
// âŒ ì˜ëª»ëœ ì‚¬ìš© - ì¼ë¶€ë§Œ Matcher ì‚¬ìš©
given(service.process("literal", anyLong()))  // ì»´íŒŒì¼ ì—ëŸ¬!

// âœ… ì˜¬ë°”ë¥¸ ì‚¬ìš© - ëª¨ë‘ Matcher ì‚¬ìš©
given(service.process(eq("literal"), anyLong()))  // OK
```

### í˜¸ì¶œ ê²€ì¦ (Verification)

```java
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.never;

// ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦
verify(repository).save(any(User.class));          // 1ë²ˆ í˜¸ì¶œë¨ (ê¸°ë³¸ê°’)
verify(repository, times(1)).save(any());          // ì •í™•íˆ 1ë²ˆ
verify(repository, times(2)).findById(anyLong());  // ì •í™•íˆ 2ë²ˆ
verify(repository, atLeast(1)).save(any());        // ìµœì†Œ 1ë²ˆ
verify(repository, atMost(3)).save(any());         // ìµœëŒ€ 3ë²ˆ
verify(repository, never()).delete(any());         // í˜¸ì¶œ ì•ˆ ë¨

// í˜¸ì¶œ ìˆœì„œ ê²€ì¦
InOrder inOrder = inOrder(repository, eventPublisher);
inOrder.verify(repository).save(any());
inOrder.verify(eventPublisher).publish(any());
```

### ArgumentCaptor (ì¸ì ìº¡ì²˜)

```java
@Captor
ArgumentCaptor<User> userCaptor;

@Test
void ì €ì¥ëœ_ì‚¬ìš©ì_ì •ë³´_ê²€ì¦() {
    // when
    userService.createUser("test@test.com");

    // then - ì‹¤ì œë¡œ ì €ì¥ëœ ê°ì²´ ìº¡ì²˜
    verify(userRepository).save(userCaptor.capture());

    User savedUser = userCaptor.getValue();
    assertThat(savedUser.getEmail()).isEqualTo("test@test.com");
    assertThat(savedUser.getStatus()).isEqualTo(UserStatus.ACTIVE);
}
```

---

## 6. ì‹¤ì œ í”„ë¡œì íŠ¸ ì ìš© ì˜ˆì‹œ

### LookMarket í”„ë¡œì íŠ¸ì˜ AuthControllerTest ë¶„ì„

```java
@WebMvcTest(AuthController.class)  // â‘  ì»¨íŠ¸ë¡¤ëŸ¬ë§Œ ë¡œë“œ
@Import({
    JwtTokenProvider.class,        // â‘¡ ì‹¤ì œ ë¹ˆ ì¶”ê°€ (í† í° ìƒì„± í•„ìš”)
    GlobalExceptionHandler.class,  // â‘¡ ì˜ˆì™¸ ì²˜ë¦¬ê¸°
    SecurityConfig.class,          // â‘¡ Security ì„¤ì •
    JwtAuthenticationFilter.class  // â‘¡ JWT í•„í„°
})
@TestPropertySource(properties = {  // â‘¢ í…ŒìŠ¤íŠ¸ìš© ì„¤ì •
    "jwt.secret=test-secret-key-for-jwt-token-generation-must-be-long-enough-for-testing",
    "jwt.access-token-expiration=3600000",
    "jwt.refresh-token-expiration=604800000"
})
class AuthControllerTest {

    @Autowired
    private MockMvc mockMvc;  // â‘£ HTTP í…ŒìŠ¤íŠ¸ ë„êµ¬

    @Autowired
    private JwtTokenProvider jwtTokenProvider;  // â‘¤ ì‹¤ì œ ë¹ˆ (í† í° ìƒì„± í•„ìš”)

    @MockBean
    private AuthService authService;  // â‘¥ ê°€ì§œ ì„œë¹„ìŠ¤ (DB ì˜ì¡´ì„± ì°¨ë‹¨)

    @Test
    void ë¡œê·¸ì¸_ì„±ê³µ() throws Exception {
        // â‘¦ Mock ë™ì‘ ì§€ì •
        given(authService.authenticate(anyString(), anyString()))
            .willReturn(testUser);

        // â‘§ HTTP ìš”ì²­ ì‹œë®¬ë ˆì´ì…˜ & ê²€ì¦
        mockMvc.perform(post("/api/v1/auth/login")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.accessToken").isNotEmpty());
    }
}
```

**í¬ì¸íŠ¸ ì„¤ëª…:**

| ë²ˆí˜¸ | ì„¤ëª… |
|------|------|
| â‘  | `@WebMvcTest`ë¡œ AuthControllerë§Œ ë¡œë“œ (ë¹ ë¥¸ í…ŒìŠ¤íŠ¸) |
| â‘¡ | `@Import`ë¡œ í•„ìš”í•œ ì‹¤ì œ ë¹ˆ ì¶”ê°€ (Security, JWT ê´€ë ¨) |
| â‘¢ | `@TestPropertySource`ë¡œ í…ŒìŠ¤íŠ¸ìš© JWT ì„¤ì • ì£¼ì… |
| â‘£ | `MockMvc`ë¡œ ì‹¤ì œ HTTP ìš”ì²­ì²˜ëŸ¼ í…ŒìŠ¤íŠ¸ |
| â‘¤ | `JwtTokenProvider`ëŠ” ì‹¤ì œ ê°ì²´ (í† í° ìƒì„±/ê²€ì¦ í•„ìš”) |
| â‘¥ | `AuthService`ëŠ” MockBean (DB ì—°ê²° ì°¨ë‹¨) |
| â‘¦ | `given().willReturn()`ìœ¼ë¡œ Mock ë™ì‘ ì •ì˜ |
| â‘§ | `mockMvc.perform()`ìœ¼ë¡œ HTTP ìš”ì²­ í›„ ê²€ì¦ |

---

## í•µì‹¬ ìš”ì•½ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ìƒí™©ë³„ ì„ íƒ ê°€ì´ë“œ

| ìƒí™© | ì‚¬ìš©í•  ê²ƒ |
|------|----------|
| Service ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ | `@ExtendWith(MockitoExtension.class)` + `@Mock` + `@InjectMocks` |
| Controller í…ŒìŠ¤íŠ¸ | `@WebMvcTest` + `@MockBean` + `MockMvc` |
| Repository í…ŒìŠ¤íŠ¸ | `@DataJpaTest` (ì‹¤ì œ DB ì‚¬ìš©) |
| í†µí•© í…ŒìŠ¤íŠ¸ | `@SpringBootTest` + `@AutoConfigureMockMvc` |
| ì™¸ë¶€ API Mock | `@MockBean` ë˜ëŠ” WireMock |

### ê¸°ì–µí•  í•µì‹¬ í¬ì¸íŠ¸

```
@Mock = ìˆœìˆ˜ Mockito ê°€ì§œ ê°ì²´ (Spring ì—†ì´)
@MockBean = Spring Contextì— ë“±ë¡ë˜ëŠ” ê°€ì§œ ë¹ˆ
@InjectMocks = Mockë“¤ì´ ì£¼ì…ë˜ëŠ” í…ŒìŠ¤íŠ¸ ëŒ€ìƒ
MockMvc = ì„œë²„ ì—†ì´ HTTP ìš”ì²­/ì‘ë‹µ í…ŒìŠ¤íŠ¸

given().willReturn() = Mock ë™ì‘ ì§€ì • (BDD ìŠ¤íƒ€ì¼)
verify() = Mock ë©”ì„œë“œ í˜¸ì¶œ ê²€ì¦
```

### í…ŒìŠ¤íŠ¸ ì‘ì„± íŒ¨í„´ (Given-When-Then)

```java
@Test
void í…ŒìŠ¤íŠ¸_ë©”ì„œë“œëª…ì€_í•œê¸€ë„_OK() {
    // given - í…ŒìŠ¤íŠ¸ ì¤€ë¹„ (Mock ë™ì‘ ì •ì˜)
    given(mockObject.method()).willReturn(value);

    // when - í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì‹¤í–‰
    Result result = testTarget.doSomething();

    // then - ê²°ê³¼ ê²€ì¦
    assertThat(result).isEqualTo(expected);
    verify(mockObject).method();  // í˜¸ì¶œ ê²€ì¦ (ì„ íƒ)
}
```

---

## 7. ê°œë°œ ë‹¨ê³„ì—ì„œì˜ API Mock (í”„ë¡ íŠ¸ì—”ë“œ í˜‘ì—…)

> ì´ ì„¹ì…˜ì€ **í…ŒìŠ¤íŠ¸ ì½”ë“œ**ê°€ ì•„ë‹Œ **ì‹¤ì œ ê°œë°œ ê³¼ì •**ì—ì„œ ì‚¬ìš©í•˜ëŠ” Mockì— ëŒ€í•´ ì„¤ëª…í•©ë‹ˆë‹¤.

### 7.1 ì™œ ê°œë°œìš© Mockì´ í•„ìš”í•œê°€?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ ë™ì‹œ ê°œë°œ ìƒí™©                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   [í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì]                    [ë°±ì—”ë“œ ê°œë°œì]                   â”‚
â”‚         â”‚                                     â”‚                         â”‚
â”‚         â”‚  "ë¡œê·¸ì¸ í™”ë©´ ë§Œë“¤ì–´ì•¼ í•˜ëŠ”ë°        â”‚                         â”‚
â”‚         â”‚   APIê°€ ì•„ì§ ì—†ì–´ìš”!"               â”‚  "DB ì„¤ê³„í•˜ê³             â”‚
â”‚         â”‚         ğŸ˜«                          â”‚   Service ë¡œì§           â”‚
â”‚         â”‚                                     â”‚   êµ¬í˜„ ì¤‘ì´ì—ìš”..."      â”‚
â”‚         â”‚                                     â”‚         ğŸ”§               â”‚
â”‚         â”‚                                     â”‚                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê¸°ë‹¤ë ¤ì•¼ í•¨? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                           â”‚                                             â”‚
â”‚                           â–¼                                             â”‚
â”‚                    âŒ ê°œë°œ ì§€ì—°!                                         â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•´ê²°ì±…: API Mockìœ¼ë¡œ ë³‘ë ¬ ê°œë°œ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Mock APIë¥¼ í™œìš©í•œ ë³‘ë ¬ ê°œë°œ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   [í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì]                    [ë°±ì—”ë“œ ê°œë°œì]                   â”‚
â”‚         â”‚                                     â”‚                         â”‚
â”‚         â”‚  Mock API í˜¸ì¶œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                         â”‚
â”‚         â”‚  (ê°€ì§œ ì‘ë‹µ ë°›ìŒ)         â”‚          â”‚  ì‹¤ì œ ë¡œì§ ê°œë°œ ì¤‘       â”‚
â”‚         â”‚         ğŸ˜Š               â”‚          â”‚         ğŸ”§               â”‚
â”‚         â”‚                          â–¼          â”‚                         â”‚
â”‚         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                         â”‚
â”‚         â”‚              â”‚   Mock Service   â”‚   â”‚                         â”‚
â”‚         â”‚              â”‚  (ê°€ì§œ ë°ì´í„°)    â”‚   â”‚                         â”‚
â”‚         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                         â”‚
â”‚         â”‚                                     â”‚                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë™ì‹œì— ê°œë°œ ê°€ëŠ¥! â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                         â”‚
â”‚   ë‚˜ì¤‘ì—: Mock â†’ ì‹¤ì œ Serviceë¡œ êµì²´                                     â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 í…ŒìŠ¤íŠ¸ Mock vs ê°œë°œ Mock ì°¨ì´

| êµ¬ë¶„ | í…ŒìŠ¤íŠ¸ Mock | ê°œë°œ Mock |
|------|------------|----------|
| **ëª©ì ** | ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ | í”„ë¡ íŠ¸ì—”ë“œ í˜‘ì—… |
| **ì‚¬ìš© ì‹œì ** | í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ | ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œ |
| **ì ìš© ë²”ìœ„** | í…ŒìŠ¤íŠ¸ ì½”ë“œ ë‚´ë¶€ | ì‹¤ì œ API ì‘ë‹µ |
| **ë¼ì´ë¸ŒëŸ¬ë¦¬** | Mockito, MockMvc | Spring Profile, ì¡°ê±´ë¶€ ë¹ˆ |
| **ìˆ˜ëª…** | í…ŒìŠ¤íŠ¸ ì¢…ë£Œ ì‹œ ì‚¬ë¼ì§ | ê°œë°œ ì™„ë£Œ ì‹œ ì œê±° |

### 7.3 êµ¬í˜„ ë°©ë²•

#### ë°©ë²• 1: Spring Profile í™œìš© (ê¶Œì¥)

**ê°œë…:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚   Profile = "mock"                    Profile = "default" (ë˜ëŠ” prod)   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚   MockUserService í™œì„±í™”              UserServiceImpl í™œì„±í™”             â”‚
â”‚   (ê°€ì§œ ë°ì´í„° ë°˜í™˜)                   (ì‹¤ì œ DB ì—°ë™)                     â”‚
â”‚                                                                         â”‚
â”‚   ì‹¤í–‰: ./gradlew bootRun             ì‹¤í–‰: ./gradlew bootRun            â”‚
â”‚         -Dspring.profiles.active=mock       (ê¸°ë³¸ê°’)                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**êµ¬í˜„ ì˜ˆì‹œ:**

```java
// 1. Service ì¸í„°í˜ì´ìŠ¤ ì •ì˜
public interface UserService {
    User getUser(Long id);
    User createUser(CreateUserRequest request);
    List<User> getAllUsers();
}

// 2. ì‹¤ì œ êµ¬í˜„ì²´ (ë‚˜ì¤‘ì— ê°œë°œ)
@Service
@Profile("!mock")  // mock í”„ë¡œíŒŒì¼ì´ ì•„ë‹ ë•Œ í™œì„±í™”
public class UserServiceImpl implements UserService {

    private final UserRepository userRepository;

    @Override
    public User getUser(Long id) {
        return userRepository.findById(id)
            .orElseThrow(() -> new UserNotFoundException(id));
    }

    @Override
    public User createUser(CreateUserRequest request) {
        // ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§...
        return userRepository.save(user);
    }
}

// 3. Mock êµ¬í˜„ì²´ (í”„ë¡ íŠ¸ì—”ë“œ í˜‘ì—…ìš©)
@Service
@Profile("mock")  // mock í”„ë¡œíŒŒì¼ì¼ ë•Œë§Œ í™œì„±í™”
public class MockUserService implements UserService {

    @Override
    public User getUser(Long id) {
        // ê°€ì§œ ë°ì´í„° ë°˜í™˜ (DB ì—°ê²° ì—†ì´!)
        return User.builder()
            .id(id)
            .email("mock-user-" + id + "@example.com")
            .name("Mock ì‚¬ìš©ì " + id)
            .role(UserRole.USER)
            .status(UserStatus.ACTIVE)
            .createdAt(LocalDateTime.now())
            .build();
    }

    @Override
    public User createUser(CreateUserRequest request) {
        // ê°€ì§œë¡œ ìƒì„±ëœ ê²ƒì²˜ëŸ¼ ì‘ë‹µ
        return User.builder()
            .id(999L)  // ê°€ì§œ ID
            .email(request.email())
            .name(request.name())
            .role(UserRole.USER)
            .status(UserStatus.ACTIVE)
            .createdAt(LocalDateTime.now())
            .build();
    }

    @Override
    public List<User> getAllUsers() {
        // ê°€ì§œ ëª©ë¡ ë°˜í™˜
        return List.of(
            getUser(1L),
            getUser(2L),
            getUser(3L)
        );
    }
}
```

**ControllerëŠ” ë³€ê²½ ì—†ìŒ:**
```java
@RestController
@RequestMapping("/api/v1/users")
@RequiredArgsConstructor
public class UserController {

    private final UserService userService;  // Mock ë˜ëŠ” Realì´ ì£¼ì…ë¨

    @GetMapping("/{id}")
    public ResponseEntity<UserResponse> getUser(@PathVariable Long id) {
        User user = userService.getUser(id);  // Profileì— ë”°ë¼ ë‹¤ë¥¸ êµ¬í˜„ì²´ í˜¸ì¶œ
        return ResponseEntity.ok(UserResponse.from(user));
    }
}
```

**ì‹¤í–‰ ë°©ë²•:**
```bash
# Mock ëª¨ë“œë¡œ ì‹¤í–‰ (í”„ë¡ íŠ¸ì—”ë“œ í˜‘ì—… ì‹œ)
./gradlew :lookmarket-api:bootRun -Dspring.profiles.active=mock

# ë˜ëŠ” application.ymlì—ì„œ ì„¤ì •
# spring:
#   profiles:
#     active: mock

# ì‹¤ì œ ëª¨ë“œë¡œ ì‹¤í–‰ (DB ì—°ë™)
./gradlew :lookmarket-api:bootRun
```

#### ë°©ë²• 2: Mock ì „ìš© Controller (ê°„ë‹¨í•œ ê²½ìš°)

```java
@RestController
@RequestMapping("/api/v1/mock")
@Profile("mock")  // mock í”„ë¡œíŒŒì¼ì—ì„œë§Œ í™œì„±í™”
public class MockController {

    // ì•„ì§ êµ¬í˜„ ì•ˆ ëœ APIë“¤ì„ ì„ì‹œë¡œ ì œê³µ

    @PostMapping("/orders")
    public ResponseEntity<Map<String, Object>> createOrder(@RequestBody Map<String, Object> request) {
        // ê°€ì§œ ì£¼ë¬¸ ì‘ë‹µ
        return ResponseEntity.status(HttpStatus.CREATED).body(Map.of(
            "orderId", 12345L,
            "status", "PENDING",
            "message", "ì£¼ë¬¸ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤ (Mock)",
            "createdAt", LocalDateTime.now().toString()
        ));
    }

    @GetMapping("/products/{id}")
    public ResponseEntity<Map<String, Object>> getProduct(@PathVariable Long id) {
        return ResponseEntity.ok(Map.of(
            "id", id,
            "name", "Mock ìƒí’ˆ " + id,
            "price", 29900,
            "stock", 100
        ));
    }
}
```

#### ë°©ë²• 3: application.ymlë¡œ Mock ë°ì´í„° ê´€ë¦¬

```yaml
# application-mock.yml
mock:
  users:
    - id: 1
      email: "user1@example.com"
      name: "í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì1"
    - id: 2
      email: "user2@example.com"
      name: "í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì2"

  products:
    - id: 1
      name: "ë‚˜ì´í‚¤ ì—ì–´ë§¥ìŠ¤"
      price: 189000
    - id: 2
      name: "ì•„ë””ë‹¤ìŠ¤ ìŠˆí¼ìŠ¤íƒ€"
      price: 129000
```

```java
@Service
@Profile("mock")
@ConfigurationProperties(prefix = "mock")
public class MockDataService implements UserService {

    private List<MockUser> users;  // ymlì—ì„œ ìë™ ë°”ì¸ë”©

    @Override
    public User getUser(Long id) {
        return users.stream()
            .filter(u -> u.getId().equals(id))
            .findFirst()
            .map(this::toUser)
            .orElseThrow(() -> new UserNotFoundException(id));
    }
}
```

### 7.4 ì‹¤ë¬´ ì›Œí¬í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ì‹¤ë¬´ì—ì„œì˜ Mock ê°œë°œ íë¦„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   1ï¸âƒ£ API ìŠ¤í™ í˜‘ì˜                                                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚   í”„ë¡ íŠ¸ì—”ë“œ + ë°±ì—”ë“œ íšŒì˜                                                â”‚
â”‚   â†’ API ë¬¸ì„œ ì‘ì„± (Swagger/OpenAPI)                                     â”‚
â”‚   â†’ ìš”ì²­/ì‘ë‹µ í˜•ì‹ í™•ì •                                                  â”‚
â”‚                                                                         â”‚
â”‚   2ï¸âƒ£ Mock API êµ¬í˜„ (ë°±ì—”ë“œ)                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚   â€¢ MockUserService êµ¬í˜„ (1-2ì‹œê°„)                                      â”‚
â”‚   â€¢ í•©ì˜ëœ ì‘ë‹µ í˜•ì‹ìœ¼ë¡œ ê°€ì§œ ë°ì´í„° ë°˜í™˜                                  â”‚
â”‚   â€¢ Profile: mock                                                       â”‚
â”‚                                                                         â”‚
â”‚   3ï¸âƒ£ ë³‘ë ¬ ê°œë°œ ì‹œì‘                                                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚   [í”„ë¡ íŠ¸ì—”ë“œ]              [ë°±ì—”ë“œ]                                     â”‚
â”‚   Mock APIë¡œ í™”ë©´ ê°œë°œ      ì‹¤ì œ Service ë¡œì§ ê°œë°œ                       â”‚
â”‚          â†“                        â†“                                     â”‚
â”‚   ë¡œê·¸ì¸ í™”ë©´ ì™„ì„±          UserServiceImpl ì™„ì„±                         â”‚
â”‚          â†“                        â†“                                     â”‚
â”‚   ìƒí’ˆ ëª©ë¡ í™”ë©´ ì™„ì„±        ProductServiceImpl ì™„ì„±                      â”‚
â”‚                                                                         â”‚
â”‚   4ï¸âƒ£ í†µí•© (Mock â†’ Real)                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚   â€¢ Profile: mock ì œê±°                                                  â”‚
â”‚   â€¢ ì‹¤ì œ Service ì—°ë™                                                   â”‚
â”‚   â€¢ í†µí•© í…ŒìŠ¤íŠ¸                                                          â”‚
â”‚                                                                         â”‚
â”‚   5ï¸âƒ£ Mock ì½”ë“œ ì •ë¦¬                                                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚   â€¢ MockService í´ë˜ìŠ¤ ì‚­ì œ (ë˜ëŠ” ë³´ê´€)                                  â”‚
â”‚   â€¢ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ í™œìš© ê°€ëŠ¥                                               â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.5 ì£¼ì˜ì‚¬í•­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           âš ï¸ ì£¼ì˜ì‚¬í•­                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   1. Mock ë°ì´í„°ëŠ” ì‹¤ì œì™€ ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ!                                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚   âŒ ë‚˜ìœ ì˜ˆ: { "data": "test" }                                        â”‚
â”‚   âœ… ì¢‹ì€ ì˜ˆ: { "id": 1, "email": "...", "createdAt": "..." }           â”‚
â”‚                                                                         â”‚
â”‚   â†’ í”„ë¡ íŠ¸ê°€ Mock ë°ì´í„°ë¡œ ê°œë°œ í›„ ì‹¤ì œ ì—°ë™ ì‹œ ë¬¸ì œ ë°œìƒ ë°©ì§€            â”‚
â”‚                                                                         â”‚
â”‚   2. ì—ëŸ¬ ì¼€ì´ìŠ¤ë„ Mock í•´ë‘ê¸°                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚   â€¢ 404 Not Found                                                       â”‚
â”‚   â€¢ 400 Bad Request (ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨)                                   â”‚
â”‚   â€¢ 401 Unauthorized                                                    â”‚
â”‚                                                                         â”‚
â”‚   â†’ í”„ë¡ íŠ¸ì—ì„œ ì—ëŸ¬ ì²˜ë¦¬ ë¡œì§ë„ ê°œë°œ ê°€ëŠ¥                                 â”‚
â”‚                                                                         â”‚
â”‚   3. Mockì€ ì„ì‹œ! ì‹¤ì œ êµ¬í˜„ í›„ ì œê±°                                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚   â€¢ @Profile("mock")ìœ¼ë¡œ ê²©ë¦¬                                           â”‚
â”‚   â€¢ ì‹¤ì œ ë°°í¬ì—ëŠ” ì ˆëŒ€ í¬í•¨ X                                            â”‚
â”‚   â€¢ Git ë¸Œëœì¹˜ë¡œ ê´€ë¦¬í•˜ê±°ë‚˜ ê°œë°œ ì™„ë£Œ í›„ ì‚­ì œ                             â”‚
â”‚                                                                         â”‚
â”‚   4. API ë¬¸ì„œì™€ ë™ê¸°í™”                                                   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚   â€¢ Mock ì‘ë‹µ = Swagger ë¬¸ì„œ = ì‹¤ì œ ì‘ë‹µ                                 â”‚
â”‚   â€¢ ì…‹ì´ ë‹¤ë¥´ë©´ ë‚˜ì¤‘ì— í˜¼ë€!                                              â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.6 LookMarket ì ìš© ì˜ˆì‹œ

```java
// MockAuthService.java - í”„ë¡ íŠ¸ì—”ë“œ í˜‘ì—…ìš©
@Service
@Profile("mock")
@Slf4j
public class MockAuthService implements AuthServicePort {

    @Override
    public User authenticate(String email, String password) {
        log.info("[MOCK] ë¡œê·¸ì¸ ì‹œë„: email={}", email);

        // íŠ¹ì • ì´ë©”ì¼ì€ ì‹¤íŒ¨ ì‹œë®¬ë ˆì´ì…˜
        if (email.contains("fail")) {
            throw new AuthenticationException("ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }

        // ì„±ê³µ ì‹œ ê°€ì§œ ì‚¬ìš©ì ë°˜í™˜
        return User.builder()
            .id(1L)
            .email(email)
            .name("Mock ì‚¬ìš©ì")
            .role(UserRole.USER)
            .status(UserStatus.ACTIVE)
            .build();
    }

    @Override
    public User validateUserForRefresh(Long userId) {
        return User.builder()
            .id(userId)
            .email("mock@example.com")
            .name("Mock ì‚¬ìš©ì")
            .role(UserRole.USER)
            .status(UserStatus.ACTIVE)
            .build();
    }
}
```

**í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìëŠ”:**
```bash
# Mock ëª¨ë“œë¡œ ë°±ì—”ë“œ ì‹¤í–‰
./gradlew :lookmarket-api:bootRun -Dspring.profiles.active=mock

# ì´ì œ http://localhost:8080/api/v1/auth/login í˜¸ì¶œí•˜ë©´
# ì‹¤ì œ DB ì—†ì´ë„ ì‘ë‹µ ë°›ìŒ!
```

### 7.7 ì •ë¦¬: ì–¸ì œ ì–´ë–¤ Mockì„ ì‚¬ìš©?

| ìƒí™© | ì‚¬ìš©í•  Mock | ì„¤ëª… |
|------|------------|------|
| **Service ë‹¨ìœ„ í…ŒìŠ¤íŠ¸** | `@Mock` + `@InjectMocks` | í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ì˜ì¡´ì„± ì°¨ë‹¨ |
| **Controller í…ŒìŠ¤íŠ¸** | `@MockBean` + `MockMvc` | Spring Contextì—ì„œ Service Mock |
| **í”„ë¡ íŠ¸ í˜‘ì—… (ë¡œì»¬)** | `@Profile("mock")` | ì‹¤ì œ API ì‘ë‹µì„ Mock |
| **í”„ë¡ íŠ¸ í˜‘ì—… (ë…ë¦½ ì„œë²„)** | Mock Server (WireMock ë“±) | ë³„ë„ Mock ì„œë²„ êµ¬ì¶• |
| **ì™¸ë¶€ API ì—°ë™ ê°œë°œ** | `@MockBean` ë˜ëŠ” WireMock | ì™¸ë¶€ ì„œë¹„ìŠ¤ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜ |

---

## ì°¸ê³  ìë£Œ

- [Mockito ê³µì‹ ë¬¸ì„œ](https://site.mockito.org/)
- [Spring Boot Testing ê°€ì´ë“œ](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.testing)
- [BDDMockito ì‚¬ìš©ë²•](https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/BDDMockito.html)
- [MockMvc ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-framework/docs/current/reference/html/testing.html#spring-mvc-test-framework)
- [WireMock - Mock Server](http://wiremock.org/)
