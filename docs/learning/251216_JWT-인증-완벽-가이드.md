# JWT ì¸ì¦ ì™„ë²½ ê°€ì´ë“œ (ì´ˆë³´ììš©)

> **ì‘ì„±ì¼ì‹œ**: 2025-12-16 23:46
>
> LookMarket í”„ë¡œì íŠ¸ì˜ JWT ì¸ì¦ êµ¬í˜„ì„ ì²˜ìŒë¶€í„° ì‰½ê²Œ ì„¤ëª…í•˜ëŠ” ë¬¸ì„œì…ë‹ˆë‹¤.

## ëª©ì°¨
1. [JWTë€ ë¬´ì—‡ì¸ê°€?](#1-jwtë€-ë¬´ì—‡ì¸ê°€)
2. [ì™œ JWTë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?](#2-ì™œ-jwtë¥¼-ì‚¬ìš©í•˜ëŠ”ê°€)
3. [Access Token vs Refresh Token](#3-access-token-vs-refresh-token)
4. [ì „ì²´ ì¸ì¦ íë¦„](#4-ì „ì²´-ì¸ì¦-íë¦„)
   - [ë¡œê·¸ì¸ íë¦„](#41-ë¡œê·¸ì¸-íë¦„)
   - [API ìš”ì²­ íë¦„](#42-api-ìš”ì²­-íë¦„-ì¸ì¦ëœ-ìš”ì²­)
   - [í† í° ê°±ì‹  íë¦„](#43-í† í°-ê°±ì‹ -íë¦„)
   - [í† í° ê°±ì‹  ì „ëµ (ìƒì„¸)](#44-í† í°-ê°±ì‹ -ì „ëµ-ìƒì„¸)
5. [ì½”ë“œ ìƒì„¸ ì„¤ëª…](#5-ì½”ë“œ-ìƒì„¸-ì„¤ëª…)
6. [í•µì‹¬ ìš©ì–´ ì •ë¦¬](#6-í•µì‹¬-ìš©ì–´-ì •ë¦¬)
7. [ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ](#7-ì‹¤ì œ-ì‚¬ìš©-ì˜ˆì‹œ)
8. [íŒŒì¼ êµ¬ì¡° ìš”ì•½](#8-íŒŒì¼-êµ¬ì¡°-ìš”ì•½)
9. [ë³´ì•ˆ ê³ ë ¤ì‚¬í•­](#9-ë³´ì•ˆ-ê³ ë ¤ì‚¬í•­)
10. [Redis ê¸°ë°˜ í† í° ê´€ë¦¬](#10-redis-ê¸°ë°˜-í† í°-ê´€ë¦¬)
    - [ì™œ Redisê°€ í•„ìš”í•œê°€?](#101-ì™œ-redisê°€-í•„ìš”í•œê°€)
    - [Redis ì €ì¥ ì „ëµ](#102-redis-ì €ì¥-ì „ëµ)
    - [ì „ëµ ë¹„êµ](#103-ì „ëµ-ë¹„êµ)
    - [ì„œë¹„ìŠ¤ë³„ ê¶Œì¥ ì „ëµ](#105-ì„œë¹„ìŠ¤ë³„-ê¶Œì¥-ì „ëµ)

---

## 1. JWTë€ ë¬´ì—‡ì¸ê°€?

### ì •ì˜
**JWT (JSON Web Token)** = ì‚¬ìš©ì ì •ë³´ë¥¼ ë‹´ì€ ì•”í˜¸í™”ëœ "í†µí–‰ì¦"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JWT = ì¶œì…ì¦ ê°™ì€ ê²ƒ                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - íšŒì‚¬ ì¶œì…ì¦ì— ì´ë¦„, ë¶€ì„œ, ê¶Œí•œì´ ì í˜€ìˆëŠ” ê²ƒì²˜ëŸ¼              â”‚
â”‚  - JWTì—ëŠ” userId, email, role ë“±ì´ ë‹´ê²¨ìˆìŒ                  â”‚
â”‚  - ìœ„ì¡° ë°©ì§€ë¥¼ ìœ„í•´ "ì„œëª…(signature)"ì´ í¬í•¨ë¨                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### JWT êµ¬ì¡° (3ë¶€ë¶„ìœ¼ë¡œ êµ¬ì„±)
```
eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxIiwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwicm9sZSI6IlVTRVIifQ.abc123...
â””â”€â”€â”€â”€â”€â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”˜.â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Payload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜.â””â”€ Signature â”€â”˜
```

| ë¶€ë¶„ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| **Header** | ì–´ë–¤ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì•”í˜¸í™”í–ˆëŠ”ì§€ | `{"alg": "HS256"}` |
| **Payload** | ì‹¤ì œ ë°ì´í„° (userId, email, role, ë§Œë£Œì‹œê°„ ë“±) | `{"sub": "1", "email": "..."}` |
| **Signature** | ìœ„ì¡° ë°©ì§€ìš© ì„œëª… (ë¹„ë°€í‚¤ë¡œ ìƒì„±) | ì„œë²„ë§Œ ê²€ì¦ ê°€ëŠ¥ |

---

## 2. ì™œ JWTë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?

### ê¸°ì¡´ ë°©ì‹ (ì„¸ì…˜) vs JWT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì„¸ì…˜ ë°©ì‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ JWT ë°©ì‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚    â”‚                                         â”‚
â”‚  [ì‚¬ìš©ì] â†’ ë¡œê·¸ì¸ â†’ [ì„œë²„]              â”‚    â”‚  [ì‚¬ìš©ì] â†’ ë¡œê·¸ì¸ â†’ [ì„œë²„]              â”‚
â”‚             â†“                           â”‚    â”‚             â†“                           â”‚
â”‚       ì„¸ì…˜ID ë°œê¸‰ (JSESSIONID)          â”‚    â”‚       JWT í† í° ë°œê¸‰                      â”‚
â”‚             â†“                           â”‚    â”‚             â†“                           â”‚
â”‚       ì„œë²„ì— ì„¸ì…˜ ì €ì¥ (ë©”ëª¨ë¦¬/DB)        â”‚    â”‚       ì„œë²„ì— ì €ì¥ ì•ˆí•¨!                   â”‚
â”‚             â†“                           â”‚    â”‚             â†“                           â”‚
â”‚  [ì‚¬ìš©ì] â†’ ìš”ì²­ ì‹œ ì„¸ì…˜ID ì²¨ë¶€          â”‚    â”‚  [ì‚¬ìš©ì] â†’ ìš”ì²­ ì‹œ JWT ì²¨ë¶€             â”‚
â”‚             â†“                           â”‚    â”‚             â†“                           â”‚
â”‚       ì„œë²„ê°€ ì„¸ì…˜ ì¡°íšŒí•´ì„œ í™•ì¸          â”‚    â”‚       ì„œë²„ê°€ ì„œëª…ë§Œ ê²€ì¦í•˜ë©´ ë          â”‚
â”‚                                         â”‚    â”‚                                         â”‚
â”‚  ë‹¨ì : ì„œë²„ í™•ì¥ ì‹œ ì„¸ì…˜ ê³µìœ  ë¬¸ì œ       â”‚    â”‚  ì¥ì : ì„œë²„ í™•ì¥í•´ë„ ë¬¸ì œ ì—†ìŒ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ ì°¨ì´ì 

| í•­ëª© | ì„¸ì…˜ ë°©ì‹ | JWT ë°©ì‹ |
|------|----------|----------|
| ìƒíƒœ ì €ì¥ | ì„œë²„ì— ì €ì¥ (Stateful) | ì €ì¥ ì•ˆí•¨ (Stateless) |
| ì„œë²„ í™•ì¥ | ì„¸ì…˜ ê³µìœ  í•„ìš” (Redis ë“±) | ê·¸ëƒ¥ í™•ì¥ ê°€ëŠ¥ |
| ê²€ì¦ ë°©ì‹ | DB/ë©”ëª¨ë¦¬ ì¡°íšŒ | ì„œëª… ê²€ì¦ë§Œ |
| ë¡œê·¸ì•„ì›ƒ | ì„¸ì…˜ ì‚­ì œë¡œ ì¦‰ì‹œ ë¬´íš¨í™” | í† í° ë§Œë£Œê¹Œì§€ ìœ íš¨ |

**í•µì‹¬**: JWTëŠ” **Stateless** (ì„œë²„ê°€ ìƒíƒœë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŒ)

---

## 3. Access Token vs Refresh Token

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  Access Token (ì¶œì…ì¦)              Refresh Token (ì¶œì…ì¦ ì¬ë°œê¸‰ê¶Œ)   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â€¢ ì‹¤ì œ API í˜¸ì¶œì— ì‚¬ìš©              â€¢ Access Token ë§Œë£Œ ì‹œ ì‚¬ìš©      â”‚
â”‚  â€¢ ì§§ì€ ìˆ˜ëª… (1ì‹œê°„)                 â€¢ ê¸´ ìˆ˜ëª… (7ì¼)                  â”‚
â”‚  â€¢ íƒˆì·¨ë˜ë©´ í”¼í•´ ê¸°ê°„ ì§§ìŒ           â€¢ íƒˆì·¨ë˜ë©´ í”¼í•´ í´ ìˆ˜ ìˆìŒ        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì™œ ë‘ ê°œë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?

| ì‹œë‚˜ë¦¬ì˜¤ | ë¬¸ì œì  |
|----------|--------|
| Access Tokenë§Œ ì‚¬ìš© (ê¸´ ìˆ˜ëª…) | íƒˆì·¨ ì‹œ ì˜¤ë˜ ì•…ìš©ë¨ |
| Access Tokenë§Œ ì‚¬ìš© (ì§§ì€ ìˆ˜ëª…) | ë§¤ë²ˆ ë¡œê·¸ì¸í•´ì•¼ í•¨ (ë¶ˆí¸) |
| **ë‘˜ ë‹¤ ì‚¬ìš©** | í¸ì˜ì„± + ë³´ì•ˆ ëª¨ë‘ í™•ë³´! |

### LookMarket ì„¤ì •

```yaml
# application.yml
jwt:
  access-token-expiration: 3600000    # 1ì‹œê°„ (ë°€ë¦¬ì´ˆ)
  refresh-token-expiration: 604800000 # 7ì¼ (ë°€ë¦¬ì´ˆ)
```

---

## 4. ì „ì²´ ì¸ì¦ íë¦„

### 4.1 ë¡œê·¸ì¸ íë¦„

```
[ì‚¬ìš©ì/í”„ë¡ íŠ¸ì—”ë“œ]                    [ì„œë²„]
       â”‚                                â”‚
       â”‚  1. POST /api/v1/auth/login    â”‚
       â”‚  { email, password }           â”‚
       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                                â”‚
       â”‚                    2. AuthController.login()
       â”‚                       - AuthService.authenticate() í˜¸ì¶œ
       â”‚                       - DBì—ì„œ ì‚¬ìš©ì ì¡°íšŒ
       â”‚                       - ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ (BCrypt)
       â”‚                                â”‚
       â”‚                    3. JwtTokenProvider
       â”‚                       - createAccessToken()
       â”‚                       - createRefreshToken()
       â”‚                                â”‚
       â”‚  4. í† í° ì‘ë‹µ                   â”‚
       â”‚  { accessToken, refreshToken } â”‚
       â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                                â”‚
       â”‚  5. í† í°ì„ localStorage ë“±ì— ì €ì¥
       â”‚                                â”‚
```

### 4.2 API ìš”ì²­ íë¦„ (ì¸ì¦ëœ ìš”ì²­)

```
[ì‚¬ìš©ì/í”„ë¡ íŠ¸ì—”ë“œ]                    [ì„œë²„]
       â”‚                                â”‚
       â”‚  1. GET /api/v1/users/me       â”‚
       â”‚  Header: Authorization:        â”‚
       â”‚          Bearer eyJhbGci...    â”‚
       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                                â”‚
       â”‚                    2. JwtAuthenticationFilter
       â”‚                       - Authorization í—¤ë”ì—ì„œ í† í° ì¶”ì¶œ
       â”‚                       - "Bearer " ì œê±°
       â”‚                                â”‚
       â”‚                    3. JwtTokenProvider.validateToken()
       â”‚                       - ì„œëª… ê²€ì¦
       â”‚                       - ë§Œë£Œ í™•ì¸
       â”‚                                â”‚
       â”‚                    4. SecurityContextì— ì¸ì¦ì •ë³´ ì €ì¥
       â”‚                       - ì´ì œ "ë¡œê·¸ì¸ëœ ì‚¬ìš©ì"ë¡œ ì¸ì‹
       â”‚                                â”‚
       â”‚                    5. Controller ì‹¤í–‰
       â”‚                       - @AuthenticationPrincipalë¡œ ì‚¬ìš©ì ì •ë³´ ì ‘ê·¼
       â”‚                                â”‚
       â”‚  6. ì‘ë‹µ                        â”‚
       â”‚  { id: 1, email: "..." }       â”‚
       â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

### 4.3 í† í° ê°±ì‹  íë¦„

```
[ì‚¬ìš©ì/í”„ë¡ íŠ¸ì—”ë“œ]                    [ì„œë²„]
       â”‚                                â”‚
       â”‚  Access Token ë§Œë£Œë¨! (1ì‹œê°„ í›„)
       â”‚                                â”‚
       â”‚  1. POST /api/v1/auth/refresh  â”‚
       â”‚  { refreshToken: "eyJ..." }    â”‚
       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                                â”‚
       â”‚                    2. Refresh Token ê²€ì¦
       â”‚                    3. ì‚¬ìš©ì ìƒíƒœ í™•ì¸ (íƒˆí‡´/ì •ì§€ ì—¬ë¶€)
       â”‚                    4. ìƒˆ Access Token + Refresh Token ë°œê¸‰
       â”‚                                â”‚
       â”‚  5. ìƒˆ í† í° ì‘ë‹µ                â”‚
       â”‚  { accessToken, refreshToken } â”‚
       â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

### 4.4 í† í° ê°±ì‹  ì „ëµ (ìƒì„¸)

#### ì–¸ì œ í† í°ì„ ê°±ì‹ í•˜ëŠ”ê°€?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                        â”‚
â”‚   ì „ëµ 1: ë§Œë£Œ í›„ ê°±ì‹  (Reactive)                                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚   â€¢ 401 ì‘ë‹µ ë°›ìœ¼ë©´ â†’ Refresh Tokenìœ¼ë¡œ ê°±ì‹  â†’ ì›ë˜ ìš”ì²­ ì¬ì‹œë„          â”‚
â”‚   â€¢ êµ¬í˜„ ê°„ë‹¨, ì‚¬ìš©ìê°€ ì ê¹ ì§€ì—° ê²½í—˜í•  ìˆ˜ ìˆìŒ                          â”‚
â”‚                                                                        â”‚
â”‚   ì „ëµ 2: ë§Œë£Œ ì „ ê°±ì‹  (Proactive) - ê¶Œì¥                                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚   â€¢ Access Token ë§Œë£Œ 5ë¶„ ì „ì— ë¯¸ë¦¬ ê°±ì‹                                  â”‚
â”‚   â€¢ ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ (ëŠê¹€ ì—†ìŒ)                                         â”‚
â”‚   â€¢ êµ¬í˜„ ë³µì¡ë„ ì¦ê°€                                                    â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### í”„ë¡ íŠ¸ì—”ë“œ í† í° ê°±ì‹  ì „ëµ (ê¶Œì¥ ë°©ì‹)

```javascript
// axios ì¸í„°ì…‰í„°ë¥¼ í™œìš©í•œ ìë™ í† í° ê°±ì‹ 
axios.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;

    // 401 ì—ëŸ¬ì´ê³ , ì•„ì§ ì¬ì‹œë„í•˜ì§€ ì•Šì€ ê²½ìš°
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;

      try {
        // Refresh Tokenìœ¼ë¡œ ìƒˆ Access Token ë°œê¸‰
        const { accessToken, refreshToken } = await refreshTokens();

        // ìƒˆ í† í° ì €ì¥
        localStorage.setItem('accessToken', accessToken);
        localStorage.setItem('refreshToken', refreshToken);

        // ì›ë˜ ìš”ì²­ ì¬ì‹œë„ (ìƒˆ í† í°ìœ¼ë¡œ)
        originalRequest.headers.Authorization = `Bearer ${accessToken}`;
        return axios(originalRequest);
      } catch (refreshError) {
        // Refresh Tokenë„ ë§Œë£Œë¨ â†’ ë¡œê·¸ì•„ì›ƒ
        logout();
        return Promise.reject(refreshError);
      }
    }

    return Promise.reject(error);
  }
);
```

#### Refresh Token Rotation (RTR)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚  Refresh Token Rotationì´ë€?                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚  â€¢ í† í° ê°±ì‹  ì‹œ ìƒˆ Refresh Tokenë„ í•¨ê»˜ ë°œê¸‰                               â”‚
â”‚  â€¢ ê¸°ì¡´ Refresh Tokenì€ ì¦‰ì‹œ ë¬´íš¨í™”                                       â”‚
â”‚  â€¢ íƒˆì·¨ëœ Refresh Tokenì˜ ì¬ì‚¬ìš© ë°©ì§€                                     â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚  â”‚ ê°±ì‹  ì „          â”‚    ê°±ì‹  í›„                                          â”‚
â”‚  â”‚                 â”‚                                                     â”‚
â”‚  â”‚ RT-001 (ìœ íš¨)   â”‚ â†’ RT-001 (ë¬´íš¨í™”)                                    â”‚
â”‚  â”‚                 â”‚ â†’ RT-002 (ìƒˆë¡œ ë°œê¸‰) âœ“                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚                                                                          â”‚
â”‚  ë§Œì•½ RT-001ë¡œ ë˜ ê°±ì‹  ì‹œë„í•˜ë©´?                                          â”‚
â”‚  â†’ "ì´ë¯¸ ì‚¬ìš©ëœ í† í°" ê°ì§€ â†’ ëª¨ë“  í† í° ë¬´íš¨í™” (íƒˆì·¨ ì˜ì‹¬)                   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Redis ê¸°ë°˜ Refresh Token ê´€ë¦¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  ì™œ Redisì— Refresh Tokenì„ ì €ì¥í•˜ëŠ”ê°€?                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚                                                                â”‚
â”‚  ë¬¸ì œì : JWTëŠ” í•œë²ˆ ë°œê¸‰ë˜ë©´ ì„œë²„ì—ì„œ ê°•ì œ ë¬´íš¨í™” ë¶ˆê°€             â”‚
â”‚  í•´ê²°ì±…: Refresh Tokenì„ Redisì— ì €ì¥í•˜ê³  ê´€ë¦¬                   â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Redis Key-Value êµ¬ì¡°                                   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  Key: "refresh_token:{userId}"                          â”‚   â”‚
â”‚  â”‚  Value: "eyJhbGciOiJIUzI1NiJ9..."                       â”‚   â”‚
â”‚  â”‚  TTL: 7ì¼ (604800ì´ˆ)                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                â”‚
â”‚  í™œìš© ì‹œë‚˜ë¦¬ì˜¤:                                                  â”‚
â”‚  1. ë¡œê·¸ì•„ì›ƒ ì‹œ â†’ Redisì—ì„œ ì‚­ì œ â†’ ì¦‰ì‹œ ë¬´íš¨í™”                   â”‚
â”‚  2. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹œ â†’ ê¸°ì¡´ í† í° ì‚­ì œ â†’ ì¬ë¡œê·¸ì¸ ìœ ë„             â”‚
â”‚  3. ê³„ì • ì •ì§€ ì‹œ â†’ í† í° ì‚­ì œ â†’ ì¦‰ì‹œ ì ‘ê·¼ ì°¨ë‹¨                     â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì „ëµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  ë°©ë²• 1: í´ë¼ì´ì–¸íŠ¸ í† í° ì‚­ì œ (í˜„ì¬ êµ¬í˜„)                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚  â€¢ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ localStorage ì‚­ì œ                             â”‚
â”‚  â€¢ ì¥ì : ì„œë²„ ë¶€í•˜ ì—†ìŒ                                         â”‚
â”‚  â€¢ ë‹¨ì : Access Token ë§Œë£Œ ì „ê¹Œì§€ ì•…ìš© ê°€ëŠ¥                     â”‚
â”‚                                                                â”‚
â”‚  ë°©ë²• 2: Token Blacklist (ì¶”ê°€ êµ¬í˜„ ê¶Œì¥)                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚  â€¢ ë¡œê·¸ì•„ì›ƒëœ Access Tokenì„ Redisì— ì €ì¥                       â”‚
â”‚  â€¢ ë§¤ ìš”ì²­ ì‹œ Blacklist í™•ì¸                                   â”‚
â”‚  â€¢ ì¥ì : ì¦‰ì‹œ ë¬´íš¨í™” ê°€ëŠ¥                                       â”‚
â”‚  â€¢ ë‹¨ì : ì•½ê°„ì˜ ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œ                                   â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Redis Blacklist êµ¬ì¡°                                   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  Key: "blacklist:{tokenHash}"                          â”‚   â”‚
â”‚  â”‚  Value: "1" (ì¡´ì¬ ì—¬ë¶€ë§Œ í™•ì¸)                           â”‚   â”‚
â”‚  â”‚  TTL: Access Token ë‚¨ì€ ë§Œë£Œ ì‹œê°„                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### í† í° ìˆ˜ëª… ì„¤ì • ê°€ì´ë“œ

| í™˜ê²½ | Access Token | Refresh Token | ì„¤ëª… |
|------|--------------|---------------|------|
| **ê°œë°œ** | 15ë¶„ | 7ì¼ | ìì£¼ ë§Œë£Œë˜ì–´ í† í° ê°±ì‹  ë¡œì§ í…ŒìŠ¤íŠ¸ ìš©ì´ |
| **ì¼ë°˜ ì„œë¹„ìŠ¤** | 1ì‹œê°„ | 14ì¼ | í¸ì˜ì„±ê³¼ ë³´ì•ˆ ê· í˜• |
| **ê¸ˆìœµ/ë³´ì•ˆ** | 5ë¶„ | 1ì¼ | ë³´ì•ˆ ìµœìš°ì„  |
| **IoT/ê¸°ê¸°** | 1ì¼ | 30ì¼ | ì‚¬ìš©ì ê°œì… ìµœì†Œí™” |

```yaml
# LookMarket í˜„ì¬ ì„¤ì • (ì¼ë°˜ ì„œë¹„ìŠ¤ ê¸°ì¤€)
jwt:
  access-token-expiration: 3600000    # 1ì‹œê°„
  refresh-token-expiration: 604800000 # 7ì¼
```

---

## 5. ì½”ë“œ ìƒì„¸ ì„¤ëª…

### 5.1 JwtTokenProvider - í† í° ìƒì„±/ê²€ì¦ ë‹´ë‹¹

**ìœ„ì¹˜**: `lookmarket-api/src/main/java/com/lookmarket/api/security/JwtTokenProvider.java`

```java
@Component  // Springì´ ìë™ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” Beanìœ¼ë¡œ ë“±ë¡
public class JwtTokenProvider {

    private final SecretKey secretKey;  // ì„œëª…ì— ì‚¬ìš©í•  ë¹„ë°€í‚¤

    // application.ymlì—ì„œ ì„¤ì •ê°’ ì£¼ì…
    public JwtTokenProvider(
        @Value("${jwt.secret}") String secret,  // ë¹„ë°€í‚¤ ë¬¸ìì—´
        @Value("${jwt.access-token-expiration}") long accessTokenExpiration  // ë§Œë£Œì‹œê°„
    ) {
        // ë¹„ë°€í‚¤ë¥¼ SecretKey ê°ì²´ë¡œ ë³€í™˜ (HMAC-SHA ì•Œê³ ë¦¬ì¦˜ìš©)
        this.secretKey = Keys.hmacShaKeyFor(...);
    }
}
```

**@Value ì–´ë…¸í…Œì´ì…˜**: application.ymlì˜ ê°’ì„ ì½”ë“œë¡œ ê°€ì ¸ì˜´
```yaml
jwt:
  secret: lookmarket-secret-key...  # â†’ @Value("${jwt.secret}")ë¡œ ì£¼ì…
  access-token-expiration: 3600000  # â†’ @Value("${jwt.access-token-expiration}")ë¡œ ì£¼ì…
```

#### í† í° ìƒì„± ë©”ì„œë“œ

```java
public String createAccessToken(Long userId, String email, String role) {
    Date now = new Date();                              // í˜„ì¬ ì‹œê°„
    Date expiry = new Date(now.getTime() + 3600000);    // 1ì‹œê°„ í›„ ë§Œë£Œ

    return Jwts.builder()
        .subject(String.valueOf(userId))  // sub: "1" (ì‚¬ìš©ì ID)
        .claim("email", email)            // email: "test@example.com"
        .claim("role", role)              // role: "USER" ë˜ëŠ” "ADMIN"
        .claim("type", "access")          // type: "access" (í† í° ì¢…ë¥˜ êµ¬ë¶„)
        .issuedAt(now)                    // iat: ë°œê¸‰ ì‹œê°„
        .expiration(expiry)               // exp: ë§Œë£Œ ì‹œê°„
        .signWith(secretKey)              // ë¹„ë°€í‚¤ë¡œ ì„œëª… (ìœ„ì¡° ë°©ì§€)
        .compact();                       // ìµœì¢… JWT ë¬¸ìì—´ ìƒì„±
}
```

**ìƒì„±ëœ JWTì˜ Payload ì˜ˆì‹œ** (ë””ì½”ë”© ì‹œ):
```json
{
  "sub": "1",
  "email": "test@example.com",
  "role": "USER",
  "type": "access",
  "iat": 1702713600,
  "exp": 1702717200
}
```

#### í† í° ê²€ì¦ ë©”ì„œë“œ

```java
public boolean validateToken(String token) {
    try {
        Jwts.parser()
            .verifyWith(secretKey)        // ìš°ë¦¬ ë¹„ë°€í‚¤ë¡œ ì„œëª… ê²€ì¦
            .build()
            .parseSignedClaims(token);    // í† í° íŒŒì‹± (ì‹¤íŒ¨í•˜ë©´ ì˜ˆì™¸ ë°œìƒ)
        return true;                       // ì—¬ê¸°ê¹Œì§€ ì˜¤ë©´ ìœ íš¨í•œ í† í°
    } catch (ExpiredJwtException e) {
        log.warn("ë§Œë£Œëœ JWT í† í°ì…ë‹ˆë‹¤");     // ì‹œê°„ ì§€ë‚¨
    } catch (MalformedJwtException e) {
        log.warn("ì˜ëª»ëœ í˜•ì‹ì˜ JWT í† í°ì…ë‹ˆë‹¤"); // í† í° í˜•ì‹ ì˜¤ë¥˜
    } catch (SecurityException e) {
        log.warn("JWT ì„œëª… ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"); // ìœ„ì¡°ëœ í† í°!
    }
    return false;  // ê²€ì¦ ì‹¤íŒ¨
}
```

---

### 5.2 JwtAuthenticationFilter - ëª¨ë“  ìš”ì²­ì„ ê°€ë¡œì±„ì„œ í† í° í™•ì¸

**ìœ„ì¹˜**: `lookmarket-api/src/main/java/com/lookmarket/api/security/JwtAuthenticationFilter.java`

```java
@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    // OncePerRequestFilter: ìš”ì²­ë‹¹ ë”± í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ëŠ” í•„í„°
}
```

#### í•µì‹¬ ë©”ì„œë“œ: doFilterInternal

```java
@Override
protected void doFilterInternal(
    HttpServletRequest request,    // ë“¤ì–´ì˜¨ HTTP ìš”ì²­
    HttpServletResponse response,  // ë‚˜ê°ˆ HTTP ì‘ë‹µ
    FilterChain filterChain        // ë‹¤ìŒ í•„í„°ë¡œ ë„˜ê¸°ëŠ” ì—­í• 
) {
    // 1. ìš”ì²­ í—¤ë”ì—ì„œ í† í° ì¶”ì¶œ
    String token = resolveToken(request);

    // 2. í† í°ì´ ìˆê³  ìœ íš¨í•˜ë©´
    if (StringUtils.hasText(token) && jwtTokenProvider.validateToken(token)) {

        // 3. Access Tokenì¸ì§€ í™•ì¸ (Refresh Tokenìœ¼ë¡œ API í˜¸ì¶œ ë°©ì§€)
        String tokenType = jwtTokenProvider.getTokenType(token);
        if ("access".equals(tokenType)) {

            // 4. í† í°ì—ì„œ Authentication ê°ì²´ ìƒì„±
            Authentication authentication = jwtTokenProvider.getAuthentication(token);

            // 5. SecurityContextì— ì €ì¥ â†’ "ì´ ì‚¬ìš©ìëŠ” ì¸ì¦ë¨!"
            SecurityContextHolder.getContext().setAuthentication(authentication);
        }
    }

    // 6. ë‹¤ìŒ í•„í„° ë˜ëŠ” Controllerë¡œ ìš”ì²­ ì „ë‹¬
    filterChain.doFilter(request, response);
}
```

#### í† í° ì¶”ì¶œ ë©”ì„œë“œ

```java
private String resolveToken(HttpServletRequest request) {
    // HTTP í—¤ë”ì—ì„œ "Authorization" ê°’ ê°€ì ¸ì˜¤ê¸°
    // ì˜ˆ: "Bearer eyJhbGciOiJIUzI1NiJ9..."
    String bearerToken = request.getHeader("Authorization");

    // "Bearer " ì ‘ë‘ì‚¬ ì œê±°í•˜ê³  ìˆœìˆ˜ í† í°ë§Œ ë°˜í™˜
    if (StringUtils.hasText(bearerToken) && bearerToken.startsWith("Bearer ")) {
        return bearerToken.substring(7);  // "Bearer " = 7ê¸€ì
    }
    return null;
}
```

---

### 5.3 SecurityConfig - Spring Security ì„¤ì •

**ìœ„ì¹˜**: `lookmarket-api/src/main/java/com/lookmarket/api/config/SecurityConfig.java`

```java
@Configuration        // ì„¤ì • í´ë˜ìŠ¤ì„ì„ ëª…ì‹œ
@EnableWebSecurity    // Spring Security í™œì„±í™”
public class SecurityConfig {

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            // CSRF ë¹„í™œì„±í™” - JWT ì‚¬ìš© ì‹œ ë¶ˆí•„ìš”
            // (CSRFëŠ” ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ì—ì„œ í•„ìš”, JWTëŠ” í—¤ë” ê¸°ë°˜)
            .csrf(AbstractHttpConfigurer::disable)

            // ì„¸ì…˜ ì‚¬ìš© ì•ˆí•¨ - JWTëŠ” Stateless
            .sessionManagement(session ->
                session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            )

            // URLë³„ ì ‘ê·¼ ê¶Œí•œ ì„¤ì •
            .authorizeHttpRequests(auth -> auth
                // ë¡œê·¸ì¸ APIëŠ” ëˆ„êµ¬ë‚˜ ì ‘ê·¼ ê°€ëŠ¥ (í† í° ì—†ì´)
                .requestMatchers("/api/v1/auth/**").permitAll()

                // Swagger ë¬¸ì„œë„ ê³µê°œ
                .requestMatchers("/swagger-ui/**").permitAll()

                // ê´€ë¦¬ì APIëŠ” ADMIN ì—­í• ë§Œ
                .requestMatchers("/api/v1/admin/**").hasRole("ADMIN")

                // ë‚˜ë¨¸ì§€ëŠ” ë¡œê·¸ì¸ í•„ìš”
                .anyRequest().authenticated()
            )

            // JWT í•„í„°ë¥¼ ê¸°ì¡´ ì¸ì¦ í•„í„° ì•ì— ì¶”ê°€
            .addFilterBefore(jwtAuthenticationFilter,
                             UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }
}
```

#### í•„í„° ì²´ì¸ ìˆœì„œ

```
HTTP ìš”ì²­ ë“¤ì–´ì˜´
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JwtAuthenticationFilter (ìš°ë¦¬ í•„í„°) â”‚  â† í† í° ê²€ì¦
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UsernamePasswordAuthenticationFilterâ”‚  â† ê¸°ì¡´ Spring í•„í„° (ì‚¬ìš© ì•ˆí•¨)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AuthorizationFilter                 â”‚  â† URLë³„ ê¶Œí•œ ì²´í¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
Controller ë„ì°©
```

---

### 5.4 AuthController - ë¡œê·¸ì¸/í† í°ê°±ì‹  API

**ìœ„ì¹˜**: `lookmarket-api/src/main/java/com/lookmarket/api/auth/AuthController.java`

```java
@RestController
@RequestMapping("/api/v1/auth")
public class AuthController {

    @PostMapping("/login")
    public ResponseEntity<TokenResponse> login(@Valid @RequestBody LoginRequest request) {

        // 1. ì‚¬ìš©ì ì¸ì¦ (ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ í™•ì¸)
        User user = authService.authenticate(request.email(), request.password());

        // 2. Access Token ìƒì„±
        String accessToken = jwtTokenProvider.createAccessToken(
            user.getId(),
            user.getEmail(),
            user.getRole().name()  // UserRole.USER â†’ "USER"
        );

        // 3. Refresh Token ìƒì„±
        String refreshToken = jwtTokenProvider.createRefreshToken(user.getId());

        // 4. ì‘ë‹µ
        return ResponseEntity.ok(TokenResponse.of(accessToken, refreshToken, 3600000));
    }
}
```

---

### 5.5 AuthService - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (Application Layer)

**ìœ„ì¹˜**: `lookmarket-application/src/main/java/com/lookmarket/application/auth/AuthService.java`

```java
@Service
public class AuthService {

    public User authenticate(String email, String rawPassword) {
        // 1. ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ
        User user = userRepository.findByEmail(email)
            .orElseThrow(() -> new AuthenticationException("ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."));
            // â†‘ ë³´ì•ˆ: "ì´ë©”ì¼ì´ ì—†ë‹¤"ê³  ì•Œë ¤ì£¼ë©´ ì•ˆë¨ (ì´ë©”ì¼ ì¡´ì¬ ì—¬ë¶€ ë…¸ì¶œ)

        // 2. ê³„ì • ìƒíƒœ í™•ì¸
        if (user.getStatus() == UserStatus.INACTIVE) {
            throw new AuthenticationException("ë¹„í™œì„±í™”ëœ ê³„ì •ì…ë‹ˆë‹¤.");
        }

        // 3. ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ (BCrypt)
        if (!passwordEncoder.matches(rawPassword, user.getPassword())) {
            // rawPassword: "mypassword123" (ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê²ƒ)
            // user.getPassword(): "$2a$10$..." (DBì— ì €ì¥ëœ í•´ì‹œê°’)
            // matches()ê°€ ë‚´ë¶€ì ìœ¼ë¡œ í•´ì‹œ ë¹„êµ
            throw new AuthenticationException("ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }

        return user;  // ì¸ì¦ ì„±ê³µ!
    }
}
```

---

## 6. í•µì‹¬ ìš©ì–´ ì •ë¦¬

| ìš©ì–´ | ì„¤ëª… |
|------|------|
| **JWT** | JSON Web Token. ì‚¬ìš©ì ì •ë³´ë¥¼ ë‹´ì€ ì•”í˜¸í™”ëœ ë¬¸ìì—´ |
| **Access Token** | API í˜¸ì¶œì— ì‚¬ìš©í•˜ëŠ” í† í° (ì§§ì€ ìˆ˜ëª…) |
| **Refresh Token** | Access Token ì¬ë°œê¸‰ì— ì‚¬ìš©í•˜ëŠ” í† í° (ê¸´ ìˆ˜ëª…) |
| **Stateless** | ì„œë²„ê°€ ì‚¬ìš©ì ìƒíƒœë¥¼ ì €ì¥í•˜ì§€ ì•ŠëŠ” ë°©ì‹ |
| **Claims** | JWTì— ë‹´ê¸´ ë°ì´í„° (userId, email, role ë“±) |
| **SecretKey** | í† í° ì„œëª…ì— ì‚¬ìš©í•˜ëŠ” ë¹„ë°€í‚¤ (ì„œë²„ë§Œ ì•Œê³  ìˆìŒ) |
| **SecurityContext** | Spring Securityê°€ ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ê³³ |
| **Filter** | ìš”ì²­ì´ Controllerì— ë„ë‹¬í•˜ê¸° ì „ì— ê°€ë¡œì±„ì„œ ì²˜ë¦¬í•˜ëŠ” ê²ƒ |
| **BCrypt** | ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ (ë‹¨ë°©í–¥ ì•”í˜¸í™”) |
| **Bearer** | HTTP Authorization í—¤ë”ì˜ ì¸ì¦ ìŠ¤í‚´ (í† í° ì•ì— ë¶™ì´ëŠ” ì ‘ë‘ì‚¬) |

---

## 7. ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

### í”„ë¡ íŠ¸ì—”ë“œ (JavaScript)

```javascript
// ========== ë¡œê·¸ì¸ ==========
const loginResponse = await fetch('/api/v1/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email: 'test@example.com',
    password: 'mypassword123'
  })
});

const { accessToken, refreshToken } = await loginResponse.json();

// í† í° ì €ì¥ (localStorage ë˜ëŠ” ë” ì•ˆì „í•œ ì €ì¥ì†Œ)
localStorage.setItem('accessToken', accessToken);
localStorage.setItem('refreshToken', refreshToken);


// ========== ì¸ì¦ì´ í•„ìš”í•œ API í˜¸ì¶œ ==========
const userData = await fetch('/api/v1/users/me', {
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
  }
});

const user = await userData.json();
console.log(user);  // { id: 1, email: "test@example.com", ... }


// ========== Access Token ë§Œë£Œ ì‹œ ê°±ì‹  ==========
const refreshResponse = await fetch('/api/v1/auth/refresh', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    refreshToken: localStorage.getItem('refreshToken')
  })
});

const newTokens = await refreshResponse.json();
localStorage.setItem('accessToken', newTokens.accessToken);
localStorage.setItem('refreshToken', newTokens.refreshToken);
```

### cURL (í„°ë¯¸ë„ì—ì„œ í…ŒìŠ¤íŠ¸)

```bash
# ë¡œê·¸ì¸
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"mypassword123"}'

# ì¸ì¦ëœ API í˜¸ì¶œ
curl http://localhost:8080/api/v1/users/me \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9..."

# í† í° ê°±ì‹ 
curl -X POST http://localhost:8080/api/v1/auth/refresh \
  -H "Content-Type: application/json" \
  -d '{"refreshToken":"eyJhbGciOiJIUzI1NiJ9..."}'
```

---

## 8. íŒŒì¼ êµ¬ì¡° ìš”ì•½

```
lookmarket-api/src/main/java/com/lookmarket/api/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ AuthController.java      # ë¡œê·¸ì¸/í† í°ê°±ì‹  API
â”‚   â”œâ”€â”€ LoginRequest.java        # ë¡œê·¸ì¸ ìš”ì²­ DTO
â”‚   â”œâ”€â”€ TokenResponse.java       # í† í° ì‘ë‹µ DTO
â”‚   â””â”€â”€ TokenRefreshRequest.java # í† í° ê°±ì‹  ìš”ì²­ DTO
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ SecurityConfig.java      # Spring Security ì„¤ì •
â”‚   â””â”€â”€ GlobalExceptionHandler.java  # ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬
â””â”€â”€ security/
    â”œâ”€â”€ JwtTokenProvider.java    # JWT ìƒì„±/ê²€ì¦
    â”œâ”€â”€ JwtUserDetails.java      # ì‚¬ìš©ì ì •ë³´ ë˜í¼
    â””â”€â”€ JwtAuthenticationFilter.java  # í† í° ê²€ì¦ í•„í„°

lookmarket-application/src/main/java/com/lookmarket/application/
â””â”€â”€ auth/
    â”œâ”€â”€ AuthService.java         # ì¸ì¦ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    â””â”€â”€ AuthenticationException.java  # ì¸ì¦ ì˜ˆì™¸
```

---

## 9. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### í˜„ì¬ êµ¬í˜„ëœ ë³´ì•ˆ ê¸°ëŠ¥

| í•­ëª© | ì„¤ëª… |
|------|------|
| ë¹„ë°€ë²ˆí˜¸ í•´ì‹± | BCrypt (ë‹¨ë°©í–¥ ì•”í˜¸í™”) |
| í† í° ì„œëª… | HMAC-SHA ì•Œê³ ë¦¬ì¦˜ |
| í† í° ë¶„ë¦¬ | Access Token (ì§§ì€ ìˆ˜ëª…) / Refresh Token (ê¸´ ìˆ˜ëª…) |
| í† í° íƒ€ì… ê²€ì¦ | Refresh Tokenìœ¼ë¡œ API í˜¸ì¶œ ì°¨ë‹¨ |
| ê³„ì • ìƒíƒœ í™•ì¸ | ë¹„í™œì„±/ì •ì§€ ê³„ì • ë¡œê·¸ì¸ ì°¨ë‹¨ |
| ì¼ë°˜ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ | "ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤" (ì •ë³´ ë…¸ì¶œ ë°©ì§€) |

### ì¶”í›„ ë³´ì™„ ê°€ëŠ¥í•œ ì‚¬í•­

| í•­ëª© | ì„¤ëª… |
|------|------|
| Refresh Token Redis ì €ì¥ | ë¡œê·¸ì•„ì›ƒ ì‹œ ì¦‰ì‹œ ë¬´íš¨í™” ê°€ëŠ¥ |
| Token Blacklist | íƒˆì·¨ëœ í† í° ì¦‰ì‹œ ì°¨ë‹¨ |
| Rate Limiting | ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜ ì œí•œ |
| IP ê²€ì¦ | í† í° ë°œê¸‰ IPì™€ ì‚¬ìš© IP ë¹„êµ |

> **ìƒì„¸ ë‚´ìš©**: ì•„ë˜ [10. Redis ê¸°ë°˜ í† í° ê´€ë¦¬](#10-redis-ê¸°ë°˜-í† í°-ê´€ë¦¬) ì„¹ì…˜ì—ì„œ ìì„¸íˆ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## 10. Redis ê¸°ë°˜ í† í° ê´€ë¦¬

### 10.1 ì™œ Redisê°€ í•„ìš”í•œê°€?

#### í˜„ì¬ êµ¬í˜„ì˜ í•œê³„ (ìˆœìˆ˜ Stateless JWT)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     í˜„ì¬ LookMarket êµ¬í˜„ ë°©ì‹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   [ì„œë²„]                              [í´ë¼ì´ì–¸íŠ¸]                        â”‚
â”‚                                                                         â”‚
â”‚   í† í° ì €ì¥: âŒ ì—†ìŒ                   í† í° ì €ì¥: localStorage            â”‚
â”‚   ê²€ì¦ ë°©ë²•: ì„œëª…ë§Œ í™•ì¸               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                                       â”‚ accessToken     â”‚               â”‚
â”‚   âœ… ì¥ì : ë¹ ë¦„, ê°„ë‹¨                  â”‚ refreshToken    â”‚               â”‚
â”‚   âŒ ë‹¨ì : ê°•ì œ ë¬´íš¨í™” ë¶ˆê°€!           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ ë¬¸ì œ**: JWTëŠ” í•œë²ˆ ë°œê¸‰ë˜ë©´ ì„œë²„ì—ì„œ ê°•ì œë¡œ ë¬´íš¨í™”í•  ë°©ë²•ì´ ì—†ìŠµë‹ˆë‹¤.

#### ë³´ì•ˆ ì·¨ì•½ì  ì‹œë‚˜ë¦¬ì˜¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      í† í° íƒˆì·¨ ì‹œë‚˜ë¦¬ì˜¤                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   [ë‚˜]                    [í•´ì»¤]                    [ì„œë²„]               â”‚
â”‚    â”‚                        â”‚                         â”‚                 â”‚
â”‚    â”‚ "ë¡œê·¸ì•„ì›ƒ í• ê²Œìš”"       â”‚                         â”‚                 â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
â”‚    â”‚                        â”‚                         â”‚                 â”‚
â”‚    â”‚ â† localStorage ì‚­ì œ    â”‚                         â”‚                 â”‚
â”‚    â”‚   (ë‚´ ë¸Œë¼ìš°ì €ì—ì„œë§Œ!)  â”‚                         â”‚                 â”‚
â”‚    â”‚                        â”‚                         â”‚                 â”‚
â”‚    â”‚                        â”‚ "íƒˆì·¨í•œ í† í°ìœ¼ë¡œ ìš”ì²­"   â”‚                 â”‚
â”‚    â”‚                        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
â”‚    â”‚                        â”‚                         â”‚                 â”‚
â”‚    â”‚                        â”‚                         â”‚ ì„œëª… ê²€ì¦... OK! â”‚
â”‚    â”‚                        â”‚                         â”‚ (ì„œë²„ëŠ” ë¡œê·¸ì•„ì›ƒ â”‚
â”‚    â”‚                        â”‚                         â”‚  ì‚¬ì‹¤ì„ ëª¨ë¦„!)   â”‚
â”‚    â”‚                        â”‚                         â”‚                 â”‚
â”‚    â”‚                        â”‚ â† ì •ìƒ ì‘ë‹µ ğŸ˜±          â”‚                 â”‚
â”‚    â”‚                        â”‚                         â”‚                 â”‚
â”‚                                                                         â”‚
â”‚   âš ï¸ ë¡œê·¸ì•„ì›ƒí–ˆëŠ”ë° í•´ì»¤ëŠ” Access Token ë§Œë£Œ(1ì‹œê°„)ê¹Œì§€ ê³„ì† ì‚¬ìš© ê°€ëŠ¥!   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Redisë¡œ í•´ê²°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Redis ì‚¬ìš© ì‹œ                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   [ì„œë²„]                              [í´ë¼ì´ì–¸íŠ¸]                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚       Redis         â”‚              í† í° ì €ì¥: localStorage           â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚  refresh_token:1    â”‚              â”‚ accessToken     â”‚              â”‚
â”‚   â”‚  â†’ "eyJ..."         â”‚              â”‚ refreshToken    â”‚              â”‚
â”‚   â”‚  TTL: 7ì¼           â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚   â”‚                     â”‚                                               â”‚
â”‚   â”‚  blacklist:abc123   â”‚  â† ë¡œê·¸ì•„ì›ƒëœ í† í°                             â”‚
â”‚   â”‚  â†’ "1"              â”‚                                               â”‚
â”‚   â”‚  TTL: ë‚¨ì€ ë§Œë£Œì‹œê°„  â”‚                                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                         â”‚
â”‚   âœ… ë¡œê·¸ì•„ì›ƒ ì¦‰ì‹œ ë¬´íš¨í™” ê°€ëŠ¥!                                           â”‚
â”‚   âœ… íƒˆì·¨ëœ í† í° ì¦‰ì‹œ ì°¨ë‹¨ ê°€ëŠ¥!                                          â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 10.2 Redis ì €ì¥ ì „ëµ

#### ì „ëµ 1: Refresh Tokenë§Œ Redisì— ì €ì¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ì „ëµ 1: Refresh Token ì €ì¥                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ì €ì¥ êµ¬ì¡°                                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚   Key:   "refresh_token:{userId}"                                       â”‚
â”‚   Value: "eyJhbGciOiJIUzI1NiJ9..."  (í˜„ì¬ ìœ íš¨í•œ Refresh Token)         â”‚
â”‚   TTL:   7ì¼ (604800ì´ˆ)                                                 â”‚
â”‚                                                                         â”‚
â”‚   ë™ì‘ ë°©ì‹                                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚   1. ë¡œê·¸ì¸ ì‹œ â†’ Redisì— Refresh Token ì €ì¥                              â”‚
â”‚   2. í† í° ê°±ì‹  ìš”ì²­ ì‹œ:                                                   â”‚
â”‚      - ìš”ì²­ëœ í† í° == Redisì— ì €ì¥ëœ í† í°? â†’ OK, ìƒˆ í† í° ë°œê¸‰             â”‚
â”‚      - ë‹¤ë¥´ë©´? â†’ ê±°ë¶€! (ì´ë¯¸ ê°±ì‹ ë˜ì—ˆê±°ë‚˜ íƒˆì·¨ëœ í† í°)                     â”‚
â”‚   3. ë¡œê·¸ì•„ì›ƒ ì‹œ â†’ Redisì—ì„œ ì‚­ì œ â†’ Refresh Token ì¦‰ì‹œ ë¬´íš¨í™”            â”‚
â”‚                                                                         â”‚
â”‚   âœ… ì¥ì                                                                 â”‚
â”‚   â€¢ Access Token ê²€ì¦ì€ ì—¬ì „íˆ ë¹ ë¦„ (Redis ì¡°íšŒ X)                        â”‚
â”‚   â€¢ Refresh Token Rotation ìë™ ì ìš©                                     â”‚
â”‚   â€¢ êµ¬í˜„ ë³µì¡ë„ ë‚®ìŒ                                                     â”‚
â”‚                                                                         â”‚
â”‚   âŒ ë‹¨ì                                                                 â”‚
â”‚   â€¢ Access Token ë§Œë£Œ ì „ì—ëŠ” ì—¬ì „íˆ ì‚¬ìš© ê°€ëŠ¥ (ìµœëŒ€ 1ì‹œê°„)                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**êµ¬í˜„ ì˜ˆì‹œ (AuthService)**:

```java
@Service
@RequiredArgsConstructor
public class AuthService {

    private final RedisTemplate<String, String> redisTemplate;
    private final long REFRESH_TOKEN_TTL = 7 * 24 * 60 * 60; // 7ì¼ (ì´ˆ)

    // ë¡œê·¸ì¸ ì‹œ Refresh Token ì €ì¥
    public TokenResponse login(String email, String password) {
        User user = authenticate(email, password);

        String accessToken = jwtTokenProvider.createAccessToken(...);
        String refreshToken = jwtTokenProvider.createRefreshToken(user.getId());

        // ğŸ†• Redisì— Refresh Token ì €ì¥
        String key = "refresh_token:" + user.getId();
        redisTemplate.opsForValue().set(key, refreshToken, REFRESH_TOKEN_TTL, TimeUnit.SECONDS);

        return TokenResponse.of(accessToken, refreshToken, ...);
    }

    // í† í° ê°±ì‹  ì‹œ Redis ê²€ì¦
    public TokenResponse refresh(String requestRefreshToken) {
        Long userId = jwtTokenProvider.getUserId(requestRefreshToken);

        // ğŸ†• Redisì—ì„œ ì €ì¥ëœ í† í° ì¡°íšŒ
        String key = "refresh_token:" + userId;
        String storedToken = redisTemplate.opsForValue().get(key);

        // ìš”ì²­ëœ í† í°ê³¼ ì €ì¥ëœ í† í° ë¹„êµ
        if (storedToken == null || !storedToken.equals(requestRefreshToken)) {
            throw new AuthenticationException("ìœ íš¨í•˜ì§€ ì•Šì€ Refresh Tokenì…ë‹ˆë‹¤.");
        }

        // ìƒˆ í† í° ë°œê¸‰ & Redis ì—…ë°ì´íŠ¸
        String newAccessToken = jwtTokenProvider.createAccessToken(...);
        String newRefreshToken = jwtTokenProvider.createRefreshToken(userId);

        redisTemplate.opsForValue().set(key, newRefreshToken, REFRESH_TOKEN_TTL, TimeUnit.SECONDS);

        return TokenResponse.of(newAccessToken, newRefreshToken, ...);
    }

    // ë¡œê·¸ì•„ì›ƒ ì‹œ Refresh Token ì‚­ì œ
    public void logout(Long userId) {
        String key = "refresh_token:" + userId;
        redisTemplate.delete(key);  // ì¦‰ì‹œ ë¬´íš¨í™”!
    }
}
```

---

#### ì „ëµ 2: Access Token Blacklist (ë” ì•ˆì „)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ì „ëµ 2: Blacklist ë°©ì‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ì €ì¥ êµ¬ì¡°                                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚   Key:   "blacklist:{tokenHash}"                                        â”‚
â”‚   Value: "1" (ì¡´ì¬ ì—¬ë¶€ë§Œ í™•ì¸)                                          â”‚
â”‚   TTL:   Access Token ë‚¨ì€ ë§Œë£Œ ì‹œê°„ (ìµœëŒ€ 1ì‹œê°„)                        â”‚
â”‚                                                                         â”‚
â”‚   ë™ì‘ ë°©ì‹                                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚   1. ë¡œê·¸ì•„ì›ƒ ì‹œ â†’ Access Tokenì„ Blacklistì— ë“±ë¡                       â”‚
â”‚   2. ëª¨ë“  API ìš”ì²­ ì‹œ (JwtAuthenticationFilter):                         â”‚
â”‚      - ì„œëª… ê²€ì¦ âœ“                                                       â”‚
â”‚      - Blacklist í™•ì¸ âœ“  â† ì¶”ê°€!                                         â”‚
â”‚      - Blacklistì— ìˆìœ¼ë©´ â†’ 401 ê±°ë¶€                                     â”‚
â”‚                                                                         â”‚
â”‚   âœ… ì¥ì                                                                 â”‚
â”‚   â€¢ ë¡œê·¸ì•„ì›ƒ ì¦‰ì‹œ Access Token ë¬´íš¨í™”                                    â”‚
â”‚   â€¢ íƒˆì·¨ëœ í† í° ì¦‰ì‹œ ì°¨ë‹¨ ê°€ëŠ¥                                           â”‚
â”‚                                                                         â”‚
â”‚   âŒ ë‹¨ì                                                                 â”‚
â”‚   â€¢ ë§¤ ìš”ì²­ë§ˆë‹¤ Redis ì¡°íšŒ (ì•½ê°„ì˜ ì˜¤ë²„í—¤ë“œ)                              â”‚
â”‚   â€¢ êµ¬í˜„ ë³µì¡ë„ ì¦ê°€                                                     â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**êµ¬í˜„ ì˜ˆì‹œ (JwtAuthenticationFilter)**:

```java
@Component
@RequiredArgsConstructor
public class JwtAuthenticationFilter extends OncePerRequestFilter {

    private final JwtTokenProvider jwtTokenProvider;
    private final RedisTemplate<String, String> redisTemplate;

    @Override
    protected void doFilterInternal(HttpServletRequest request, ...) {
        String token = resolveToken(request);

        if (StringUtils.hasText(token) && jwtTokenProvider.validateToken(token)) {

            // ğŸ†• Blacklist í™•ì¸
            if (isBlacklisted(token)) {
                log.warn("Blacklistì— ë“±ë¡ëœ í† í°ìœ¼ë¡œ ì ‘ê·¼ ì‹œë„");
                // ì¸ì¦ ì •ë³´ ì„¤ì •í•˜ì§€ ì•ŠìŒ â†’ 401 ì‘ë‹µ
            } else {
                String tokenType = jwtTokenProvider.getTokenType(token);
                if ("access".equals(tokenType)) {
                    Authentication auth = jwtTokenProvider.getAuthentication(token);
                    SecurityContextHolder.getContext().setAuthentication(auth);
                }
            }
        }

        filterChain.doFilter(request, response);
    }

    // Blacklist í™•ì¸
    private boolean isBlacklisted(String token) {
        String tokenHash = hashToken(token);
        String key = "blacklist:" + tokenHash;
        return Boolean.TRUE.equals(redisTemplate.hasKey(key));
    }

    // í† í° í•´ì‹œ (ì „ì²´ í† í° ì €ì¥í•˜ë©´ ë©”ëª¨ë¦¬ ë‚­ë¹„)
    private String hashToken(String token) {
        return DigestUtils.sha256Hex(token);
    }
}
```

**êµ¬í˜„ ì˜ˆì‹œ (ë¡œê·¸ì•„ì›ƒ API)**:

```java
@RestController
@RequestMapping("/api/v1/auth")
@RequiredArgsConstructor
public class AuthController {

    private final RedisTemplate<String, String> redisTemplate;
    private final JwtTokenProvider jwtTokenProvider;

    @PostMapping("/logout")
    public ResponseEntity<Void> logout(@RequestHeader("Authorization") String bearerToken) {
        String accessToken = bearerToken.substring(7);  // "Bearer " ì œê±°

        // ë‚¨ì€ ë§Œë£Œ ì‹œê°„ ê³„ì‚°
        long remainingTimeMs = jwtTokenProvider.getRemainingTime(accessToken);
        long remainingTimeSec = remainingTimeMs / 1000;

        if (remainingTimeSec > 0) {
            // Blacklistì— ë“±ë¡ (ë‚¨ì€ ì‹œê°„ë§Œí¼ë§Œ ë³´ê´€ - ë©”ëª¨ë¦¬ ì ˆì•½)
            String tokenHash = DigestUtils.sha256Hex(accessToken);
            String key = "blacklist:" + tokenHash;
            redisTemplate.opsForValue().set(key, "1", remainingTimeSec, TimeUnit.SECONDS);
        }

        // Refresh Tokenë„ ì‚­ì œ (ì „ëµ 1 ë³‘í–‰ ì‹œ)
        Long userId = jwtTokenProvider.getUserId(accessToken);
        redisTemplate.delete("refresh_token:" + userId);

        return ResponseEntity.noContent().build();
    }
}
```

---

### 10.3 ì „ëµ ë¹„êµ

| í•­ëª© | ìˆœìˆ˜ JWT (í˜„ì¬) | ì „ëµ 1: Refreshë§Œ Redis | ì „ëµ 2: Blacklist ì¶”ê°€ |
|------|----------------|------------------------|---------------------|
| **ë³´ì•ˆ ìˆ˜ì¤€** | â­â­ | â­â­â­ | â­â­â­â­â­ |
| **ì„±ëŠ¥** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ |
| **êµ¬í˜„ ë³µì¡ë„** | ê°„ë‹¨ | ë³´í†µ | ë³µì¡ |
| **ë¡œê·¸ì•„ì›ƒ ì¦‰ì‹œ ë¬´íš¨í™”** | âŒ | Refreshë§Œ | âœ… ì™„ì „ |
| **Access Token ê°•ì œ ë¬´íš¨í™”** | âŒ | âŒ | âœ… |
| **Redis ì˜ì¡´ì„±** | ì—†ìŒ | ìˆìŒ | ìˆìŒ |
| **ë§¤ ìš”ì²­ Redis ì¡°íšŒ** | âŒ | âŒ | âœ… |

### 10.4 ê¶Œì¥ ì¡°í•©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ì‹¤ë¬´ì—ì„œ ê¶Œì¥í•˜ëŠ” ì¡°í•©                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ì „ëµ 1 + ì „ëµ 2 ë³‘í–‰ ì‚¬ìš©                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚                                                                         â”‚
â”‚   [Redis]                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚   â”‚  refresh_token:1 â†’ "eyJ..."  (7ì¼ TTL)  â”‚  â† Refresh Token ê´€ë¦¬    â”‚
â”‚   â”‚  refresh_token:2 â†’ "eyJ..."  (7ì¼ TTL)  â”‚                           â”‚
â”‚   â”‚                                         â”‚                           â”‚
â”‚   â”‚  blacklist:abc123 â†’ "1"  (1ì‹œê°„ TTL)    â”‚  â† ë¡œê·¸ì•„ì›ƒëœ Access Token â”‚
â”‚   â”‚  blacklist:def456 â†’ "1"  (30ë¶„ TTL)     â”‚                           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                         â”‚
â”‚   íš¨ê³¼                                                                   â”‚
â”‚   â”€â”€â”€â”€                                                                   â”‚
â”‚   â€¢ ë¡œê·¸ì•„ì›ƒ ì‹œ Access Token ì¦‰ì‹œ ë¬´íš¨í™” (Blacklist)                     â”‚
â”‚   â€¢ ë¡œê·¸ì•„ì›ƒ ì‹œ Refresh Token ì¦‰ì‹œ ë¬´íš¨í™” (ì‚­ì œ)                         â”‚
â”‚   â€¢ Refresh Token Rotationìœ¼ë¡œ íƒˆì·¨ ë°©ì§€                                 â”‚
â”‚   â€¢ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹œ ëª¨ë“  ì„¸ì…˜ ê°•ì œ ë¡œê·¸ì•„ì›ƒ ê°€ëŠ¥                          â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.5 ì„œë¹„ìŠ¤ë³„ ê¶Œì¥ ì „ëµ

| ì„œë¹„ìŠ¤ ìœ í˜• | ê¶Œì¥ ì „ëµ | ì´ìœ  |
|------------|----------|------|
| **ê°œë°œ/í•™ìŠµ** | ìˆœìˆ˜ JWT | ë‹¨ìˆœí•¨, ê°œë… ì´í•´ì— ì§‘ì¤‘ |
| **ì¼ë°˜ ì›¹ì„œë¹„ìŠ¤** | ì „ëµ 1 (Refreshë§Œ Redis) | ë³´ì•ˆê³¼ ì„±ëŠ¥ì˜ ê· í˜• |
| **ê¸ˆìœµ/ì˜ë£Œ** | ì „ëµ 1 + 2 ë³‘í–‰ | ìµœê³  ìˆ˜ì¤€ ë³´ì•ˆ í•„ìš” |
| **IoT/ê¸°ê¸° ì¸ì¦** | ì „ëµ 1 | ê¸´ í† í° ìˆ˜ëª…, ê°±ì‹  ìµœì†Œí™” |

### 10.6 LookMarket ì ìš© ê³„íš

```
Phase 1 (í˜„ì¬): ìˆœìˆ˜ JWT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ ê¸°ë³¸ JWT ì¸ì¦ êµ¬í˜„ ì™„ë£Œ âœ…
â€¢ ê°œë… ì´í•´ ë° í•™ìŠµì— ì§‘ì¤‘

Phase 4 (Kafka í†µí•© ì‹œ): Redis ì—°ë™
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ ì „ëµ 1 + 2 ë³‘í–‰ êµ¬í˜„ ì˜ˆì •
â€¢ Redis ì¸í”„ë¼ ì´ë¯¸ ì¤€ë¹„ë¨ (docker-compose)
â€¢ ì‹¤ì œ ì„œë¹„ìŠ¤ ìˆ˜ì¤€ì˜ ë³´ì•ˆ êµ¬í˜„
```

---

## ì°¸ê³  ìë£Œ

- [JWT ê³µì‹ ì‚¬ì´íŠ¸](https://jwt.io/)
- [Spring Security ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-security/reference/)
- [jjwt ë¼ì´ë¸ŒëŸ¬ë¦¬ GitHub](https://github.com/jwtk/jjwt)
